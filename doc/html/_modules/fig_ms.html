

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>fig_ms &mdash; call-time-model  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/p_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> call-time-model
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">call-time-model</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>fig_ms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fig_ms</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions that generate the figures for the manuscript. Main function: generate_figures(). [call-time-model]</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># the published figures were plotted using lualatex and the font Helvetica. If installed, set these to true:</span>
<span class="n">B_USE_LATEX</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">B_USE_HELVETICA</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="k">if</span> <span class="n">B_USE_LATEX</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;pgf&#39;</span><span class="p">)</span>  <span class="c1"># noqa: E402 (must come before importing pyplot)</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pgf</span> <span class="kn">import</span> <span class="n">FigureCanvasPgf</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">backend_bases</span><span class="o">.</span><span class="n">register_backend</span><span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">FigureCanvasPgf</span><span class="p">)</span>  <span class="c1"># noqa: E402 (must come before importing pyplot)</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">backend_bases</span><span class="o">.</span><span class="n">register_backend</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">FigureCanvasPgf</span><span class="p">)</span>  <span class="c1"># noqa: E402 (must come before importing pyplot)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">brian2</span> <span class="k">as</span> <span class="nn">b2</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="kn">import</span> <span class="nn">routine</span>
<span class="kn">from</span> <span class="nn">fcn</span> <span class="kn">import</span> <span class="n">p_io</span><span class="p">,</span> <span class="n">p_util</span><span class="p">,</span> <span class="n">p_plot</span><span class="p">,</span> <span class="n">p_analysis</span>

<span class="c1"># globals</span>
<span class="n">C_COLORS</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.050</span><span class="p">,</span> <span class="mf">0.350</span><span class="p">,</span> <span class="mf">0.800</span><span class="p">],</span>  <span class="c1"># 0 blue</span>
            <span class="p">[</span><span class="mf">0.850</span><span class="p">,</span> <span class="mf">0.450</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span>  <span class="c1"># 1 orange</span>
            <span class="p">[</span><span class="mf">0.933</span><span class="p">,</span> <span class="mf">0.400</span><span class="p">,</span> <span class="mf">0.550</span><span class="p">],</span>  <span class="c1"># 2 pink</span>
            <span class="p">[</span><span class="mf">0.750</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">],</span>  <span class="c1"># 3 red</span>
            <span class="p">[</span><span class="mf">0.850</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">],</span>  <span class="c1"># 4 yellow</span>
            <span class="p">[</span><span class="mf">0.150</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span>  <span class="c1"># 5 teal</span>
            <span class="p">[</span><span class="mf">0.286</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.573</span><span class="p">],</span>  <span class="c1"># 6 purple</span>
            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>  <span class="c1"># -1 black</span>
<span class="n">C_COLORS_LIGHT</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.300</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>  <span class="c1"># 0 blue</span>
                  <span class="p">[</span><span class="mf">1.000</span><span class="p">,</span> <span class="mf">0.650</span><span class="p">,</span> <span class="mf">0.200</span><span class="p">],</span>  <span class="c1"># 1 orange</span>
                  <span class="p">[</span><span class="mf">1.000</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.800</span><span class="p">],</span>  <span class="c1"># 2 pink</span>
                  <span class="p">[</span><span class="mf">1.000</span><span class="p">,</span> <span class="mf">0.350</span><span class="p">,</span> <span class="mf">0.350</span><span class="p">],</span>  <span class="c1"># 3 red</span>
                  <span class="p">[</span><span class="mf">0.950</span><span class="p">,</span> <span class="mf">0.850</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span>  <span class="c1"># 4 yellow</span>
                  <span class="p">[</span><span class="mf">0.250</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">],</span>  <span class="c1"># 5 teal</span>
                  <span class="p">[</span><span class="mf">0.686</span><span class="p">,</span> <span class="mf">0.400</span><span class="p">,</span> <span class="mf">0.973</span><span class="p">],</span>  <span class="c1"># 6 purple</span>
                  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>  <span class="c1"># -1 black</span>
<span class="n">COL_SEQ</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># sequence of indices to C_COLORS used for populations by order of appearence</span>
<span class="n">FONTSIZE_XXS</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">FONTSIZE_XS</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">FONTSIZE_S</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">FONTSIZE_M</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">FONTSIZE_L</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">FONTSIZE_XL</span> <span class="o">=</span> <span class="mi">16</span>


<div class="viewcode-block" id="generate_figures"><a class="viewcode-back" href="../fig_ms.html#fig_ms.generate_figures">[docs]</a><span class="k">def</span> <span class="nf">generate_figures</span><span class="p">(</span><span class="n">b_save_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main function that loads data, calls the functions that plot the individual figures, and saves those.</span>

<span class="sd">    :param b_save_figures: If False, figures will not be saved.</span>
<span class="sd">    :type b_save_figures: bool</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># selectively plot individual figures by setting the corresponding values to 1 and all others to 0:</span>
    <span class="c1"># plot figures      1, 2, 3, 4, 5, sens, sens2, curr, psp, psa, depolarized</span>
    <span class="n">b_plot_fig</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">]</span>
    <span class="n">dpi_fig</span> <span class="o">=</span> <span class="mi">600</span>
    <span class="n">figure_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">]</span>  <span class="c1"># [&#39;png&#39;, &#39;pdf&#39;, &#39;eps&#39;]</span>

    <span class="c1"># settings necessary for having text of different colors within a string using latex</span>
    <span class="c1"># needs matplotlib.use(&#39;pgf&#39;) before importing pyplot (see above)</span>
    <span class="k">if</span> <span class="n">B_USE_LATEX</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;text.usetex&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># use inline math for ticks</span>
            <span class="s2">&quot;pgf.rcfonts&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># don&#39;t setup fonts from rc parameters (needed for \textbf and \textcolor)</span>
            <span class="s2">&quot;pgf.texsystem&quot;</span><span class="p">:</span> <span class="s2">&quot;lualatex&quot;</span><span class="p">,</span>  <span class="c1"># requires lualatex and texlive-luatex</span>
            <span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">:</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pgf.preamble&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;\usepackage</span><span class="si">{color}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\usepackage</span><span class="si">{fontspec}</span><span class="s1">&#39;</span><span class="p">]})</span>
        <span class="k">if</span> <span class="n">B_USE_HELVETICA</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s2">&quot;mathtext.rm&quot;</span><span class="p">:</span> <span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mathtext.it&quot;</span><span class="p">:</span> <span class="s2">&quot;Helvetica:italic&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mathtext.bf&quot;</span><span class="p">:</span> <span class="s2">&quot;Helvetica:bold&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pgf.preamble&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;\usepackage</span><span class="si">{color}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\usepackage</span><span class="si">{fontspec}</span><span class="s1">&#39;</span><span class="p">,</span>
                                 <span class="sa">r</span><span class="s1">&#39;\setsansfont</span><span class="si">{Helvetica}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\setmainfont</span><span class="si">{Helvetica}</span><span class="s1">&#39;</span><span class="p">]})</span>

    <span class="c1"># set font sizes</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_M</span><span class="p">)</span>  <span class="c1"># controls default text sizes</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="n">FONTSIZE_L</span><span class="p">)</span>  <span class="c1"># fontsize of the axes title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">)</span>  <span class="c1"># fontsize of the x and y labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">FONTSIZE_XS</span><span class="p">)</span>  <span class="c1"># fontsize of the tick labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">FONTSIZE_XS</span><span class="p">)</span>  <span class="c1"># fontsize of the tick labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_XXS</span><span class="p">)</span>  <span class="c1"># legend fontsize</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="n">FONTSIZE_M</span><span class="p">)</span>  <span class="c1"># fontsize of the figure title</span>

    <span class="c1"># directories, indices and other parameters</span>
    <span class="n">path_to_traces_example</span> <span class="o">=</span> <span class="s1">&#39;rec/traces/example_traces&#39;</span>
    <span class="n">path_to_traces_spiking</span> <span class="o">=</span> <span class="s1">&#39;rec/traces/PM_spiking&#39;</span>
    <span class="n">path_to_traces_gabazine</span> <span class="o">=</span> <span class="s1">&#39;rec/traces/PM_gabazine&#39;</span>
    <span class="n">path_to_traces_playback_aligned</span> <span class="o">=</span> <span class="s1">&#39;rec/traces/playback_aligned&#39;</span>
    <span class="n">path_to_traces_nif</span> <span class="o">=</span> <span class="s1">&#39;rec/traces/NIf&#39;</span>
    <span class="n">path_to_spiketimes_int</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/interneurons_n-gt-three&#39;</span>
    <span class="n">path_to_spiketimes_spiking</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/PM_spiking&#39;</span>
    <span class="n">path_to_spiketimes_gabazine</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/PM_gabazine&#39;</span>
    <span class="n">path_to_spiketimes_nif</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/NIf&#39;</span>
    <span class="n">filename_nexus_mat</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/nexus_spiketimes/spks_rfrmt.mat&#39;</span>  <span class="c1"># final</span>
    <span class="n">filename_nexus_responses_mat</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/nexus_spiketimes/nexus_responses.mat&#39;</span>
    <span class="n">filename_nexus_psth_mat</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/nexus_spiketimes/psth_data.mat&#39;</span>  <span class="c1"># psth data from margarida&#39;s script</span>
    <span class="n">filename_nexus_responsive_idx</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/nexus_spiketimes/idx_responsive_neurons.mat&#39;</span>
    <span class="n">filename_nexus_putativeint_idx</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/nexus_spiketimes/idx_putativeint.mat&#39;</span>
    <span class="n">filename_nexus_putativeint_responsive_idx</span> <span class="o">=</span> <span class="s1">&#39;rec/spiketimes/nexus_spiketimes/idx_putativeint_responsive.mat&#39;</span>

    <span class="c1"># load model data</span>
    <span class="c1"># NOTE: IN THIS SCRIPT &quot;MODEL 0&quot; (or mod0, m0, ag0) REFERS TO THE NO-INHIBITION MODEL, &quot;MODEL 1&quot; TO THE</span>
    <span class="c1"># FEED_FORWARD INHIBITION MODEL AND &quot;MODEL 2&quot; REFERS TO THE TONIC INHIBITION MODEL</span>
    <span class="n">mod1_name_free_w</span> <span class="o">=</span> <span class="s1">&#39;ff-inh_free-w&#39;</span>
    <span class="n">states_fw</span><span class="p">,</span> <span class="n">spikes_fw</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_fw</span><span class="p">,</span> <span class="n">info_fw</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod1_name_free_w</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">mod1_name_hyper</span> <span class="o">=</span> <span class="s1">&#39;ff-inh_free-w_exc&#39;</span>
        <span class="n">states_hy</span><span class="p">,</span> <span class="n">spikes_hy</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_hy</span><span class="p">,</span> <span class="n">info_hy</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod1_name_hyper</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">mod1_aggregate_path</span> <span class="o">=</span> <span class="s1">&#39;out/ff-inh_agg_lo/aggregate/ff-inh_agg_lo_aggregate_subset_nrn180.pkl&#39;</span>
        <span class="n">states_ag1</span><span class="p">,</span> <span class="n">spikes_ag1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info_ag1</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">mod1_aggregate_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">mod0_name_no_ffint</span> <span class="o">=</span> <span class="s1">&#39;no-inh_free-w&#39;</span>
        <span class="n">states_m0</span><span class="p">,</span> <span class="n">spikes_m0</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_m0</span><span class="p">,</span> <span class="n">info_m0</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod0_name_no_ffint</span><span class="p">)</span>
        <span class="n">mod0_name_no_spiking</span> <span class="o">=</span> <span class="s1">&#39;no-inh_free-w_no-spiking&#39;</span>
        <span class="n">states_m0_nospike</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_m0_nospike</span><span class="p">,</span> <span class="n">info_m0_nospike</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod0_name_no_spiking</span><span class="p">)</span>
        <span class="n">mod1_name_no_spiking</span> <span class="o">=</span> <span class="s1">&#39;ff-inh_free-w_no-spiking&#39;</span>
        <span class="n">states_m1_nospike</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_m1_nospike</span><span class="p">,</span> <span class="n">info_m1_nospike</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod1_name_no_spiking</span><span class="p">)</span>
        <span class="n">mod2_name_no_spiking</span> <span class="o">=</span> <span class="s1">&#39;tonic-inh_free-w_no-spiking&#39;</span>
        <span class="n">states_m2_nospike</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_m2_nospike</span><span class="p">,</span> <span class="n">info_m2_nospike</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod2_name_no_spiking</span><span class="p">)</span>
        <span class="n">mod2_name_tonic_int</span> <span class="o">=</span> <span class="s1">&#39;tonic-inh_free-w&#39;</span>
        <span class="n">states_m2</span><span class="p">,</span> <span class="n">spikes_m2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_m2</span><span class="p">,</span> <span class="n">info_m2</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod2_name_tonic_int</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">mod0_aggregate_path</span> <span class="o">=</span> <span class="s1">&#39;out/no-inh_agg_lo/aggregate/no-inh_agg_lo_aggregate_subset_nrn181.pkl&#39;</span>
        <span class="n">states_ag0</span><span class="p">,</span> <span class="n">spikes_ag0</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info_ag0</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">mod0_aggregate_path</span><span class="p">)</span>
        <span class="n">mod2_aggregate_path</span> <span class="o">=</span> <span class="s1">&#39;out/tonic-inh_agg_lo/aggregate/tonic-inh_agg_lo_aggregate_subset_nrn181.pkl&#39;</span>
        <span class="n">states_ag2</span><span class="p">,</span> <span class="n">spikes_ag2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info_ag2</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">mod2_aggregate_path</span><span class="p">)</span>
        <span class="n">mod1_agg_low_inh_path</span> <span class="o">=</span> <span class="s1">&#39;out/ff-inh_agg_low-inh_lo/aggregate/ff-inh_agg_low-inh_lo_aggregate_subset_nrn180.pkl&#39;</span>
        <span class="n">states_ag1_lowin</span><span class="p">,</span> <span class="n">spikes_ag1_lowin</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info_ag1_lowin</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">mod1_agg_low_inh_path</span><span class="p">)</span>
        <span class="n">mod2_agg_low_inh_path</span> <span class="o">=</span> <span class="s1">&#39;out/tonic-inh_agg_low-inh_lo/aggregate/tonic-inh_agg_low-inh_lo_aggregate_subset_nrn181.pkl&#39;</span>
        <span class="n">states_ag2_lowin</span><span class="p">,</span> <span class="n">spikes_ag2_lowin</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info_ag2_lowin</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">mod2_agg_low_inh_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">mod1_jam_only_fw</span> <span class="o">=</span> <span class="s1">&#39;ff-inh_jam_only_free-w&#39;</span>
        <span class="n">states_jam_only</span><span class="p">,</span> <span class="n">spikes_jam_only</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_jam_only</span><span class="p">,</span> <span class="n">info_jam_only</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod1_jam_only_fw</span><span class="p">)</span>
        <span class="n">mod1_jam_free_t</span> <span class="o">=</span> <span class="s1">&#39;ff-inh_jam_free-t&#39;</span>  <span class="c1"># this was single jam pop</span>
        <span class="n">states_jam_ft</span><span class="p">,</span> <span class="n">spikes_jam_ft</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_jam_ft</span><span class="p">,</span> <span class="n">info_jam_ft</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod1_jam_free_t</span><span class="p">)</span>
        <span class="n">suppr_win</span> <span class="o">=</span> <span class="n">get_suppression_window</span><span class="p">(</span><span class="n">config_jam_only</span><span class="p">,</span> <span class="n">spikes_jam_ft</span><span class="p">,</span> <span class="n">config_jam_ft</span><span class="p">,</span> <span class="n">info_jam_ft</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">mod1_agg_jam_only</span> <span class="o">=</span> <span class="s1">&#39;out/ff-inh_jam_only_agg_lo/aggregate/ff-inh_jam_only_agg_lo_aggregate_subset_nrn180.pkl&#39;</span>
        <span class="n">states_agg_jam_only</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">info_agg_jam_only</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">mod1_agg_jam_only</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
        <span class="n">config_name_sens_weights_lo</span> <span class="o">=</span> <span class="s1">&#39;param_exp_sensitivity_weights_lo&#39;</span>
        <span class="n">run_id_sens_weights</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
        <span class="n">config_name_sens_pop_lo</span> <span class="o">=</span> <span class="s1">&#39;param_exp_sensitivity_pop-size_lo&#39;</span>
        <span class="n">run_id_sens_pop</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
        <span class="n">mod_current</span> <span class="o">=</span> <span class="s1">&#39;ff-inh_current_plot&#39;</span>
        <span class="n">states_curr</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_curr</span><span class="p">,</span> <span class="n">info_curr</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod_current</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
        <span class="n">mod_psp</span> <span class="o">=</span> <span class="s1">&#39;properties-synapses&#39;</span>
        <span class="n">states_psp</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">config_psp</span><span class="p">,</span> <span class="n">info_psp</span> <span class="o">=</span> <span class="n">load_model_data</span><span class="p">(</span><span class="n">mod_psp</span><span class="p">)</span>

    <span class="c1"># load recording data</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">traces_example</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">spiketimes_int</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_recording_data</span><span class="p">(</span><span class="n">path_to_traces_example</span><span class="p">,</span> <span class="n">path_to_spiketimes_int</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">traces_spiking</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_recording_data</span><span class="p">(</span><span class="n">path_to_traces_spiking</span><span class="p">,</span>
                                                                       <span class="n">path_to_spiketimes_spiking</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">traces_gabazine</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
            <span class="n">load_recording_data</span><span class="p">(</span><span class="n">path_to_traces_gabazine</span><span class="p">,</span> <span class="n">path_to_spiketimes_gabazine</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">traces_nif</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">spiketimes_nif</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_recording_data</span><span class="p">(</span><span class="n">path_to_traces_nif</span><span class="p">,</span> <span class="n">path_to_spiketimes_nif</span><span class="p">)</span>

    <span class="c1"># load behavioral data</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">call_onset_times</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;rec/behavioral_data/all_call_onset_times.mat&#39;</span><span class="p">)</span>

    <span class="c1"># load playback-aligned premotor traces</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
        <span class="n">traces_playback_aligned</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_recording_data</span><span class="p">(</span><span class="n">path_to_traces_playback_aligned</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># load neuronexus data with original neuron ids</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">spiketimes_nexus</span><span class="p">,</span> <span class="n">info_bslcup</span><span class="p">,</span> <span class="n">playback_name</span><span class="p">,</span> <span class="n">playback_dur</span><span class="p">,</span> <span class="n">playback_type</span><span class="p">,</span> <span class="n">unit_id</span> <span class="o">=</span> \
            <span class="n">p_io</span><span class="o">.</span><span class="n">load_neuronexus_spiketimes_from_mat</span><span class="p">(</span><span class="n">filename_nexus_mat</span><span class="p">)</span>
        <span class="n">idx_nexus_responsive</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename_nexus_responsive_idx</span><span class="p">)</span>
        <span class="n">idx_nexus_putativeint</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename_nexus_putativeint_idx</span><span class="p">)</span>
        <span class="n">idx_nexus_putativeint_responsive</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename_nexus_putativeint_responsive_idx</span><span class="p">)</span>
        <span class="n">psths_nexus_matlab</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename_nexus_psth_mat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="c1"># load times of significant responses in neuronexus psths, for the horizontal bar plot</span>
        <span class="n">nexus_responses</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename_nexus_responses_mat</span><span class="p">)</span>

    <span class="c1"># load embedded images</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">img_name_zf_calling</span> <span class="o">=</span> <span class="s1">&#39;fig/embed/zf_calling.png&#39;</span>
        <span class="n">img_zf_calling</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_name_zf_calling</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">img_name_zf_listening</span> <span class="o">=</span> <span class="s1">&#39;fig/embed/zf_listening.png&#39;</span>
        <span class="n">img_zf_listening</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_name_zf_listening</span><span class="p">)</span>
        <span class="n">img_name_speaker</span> <span class="o">=</span> <span class="s1">&#39;fig/embed/speaker.png&#39;</span>
        <span class="n">img_speaker</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_name_speaker</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">img_name_bubble</span> <span class="o">=</span> <span class="s1">&#39;fig/embed/bubble.png&#39;</span>
        <span class="n">img_bubble</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_name_bubble</span><span class="p">)</span>

    <span class="c1"># plot figures</span>
    <span class="n">pathname_fig</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">BASE_PATH_OUTPUT</span> <span class="o">+</span> <span class="s1">&#39;fig&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;figures&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">figure1</span><span class="p">(</span><span class="n">states_fw</span><span class="p">,</span> <span class="n">spikes_fw</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">,</span> <span class="n">states_hy</span><span class="p">,</span> <span class="n">info_hy</span><span class="p">,</span>
                            <span class="n">states_ag1</span><span class="p">,</span> <span class="n">spikes_ag1</span><span class="p">,</span> <span class="n">info_ag1</span><span class="p">,</span> <span class="n">traces_example</span><span class="p">,</span>
                            <span class="n">spiketimes_int</span><span class="p">,</span> <span class="n">traces_spiking</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">img_zf_calling</span><span class="p">,</span> <span class="n">img_bubble</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig1</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;fig1&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">figure2</span><span class="p">(</span><span class="n">states_fw</span><span class="p">,</span> <span class="n">spikes_fw</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">,</span> <span class="n">config_fw</span><span class="p">,</span> <span class="n">states_m0</span><span class="p">,</span> <span class="n">spikes_m0</span><span class="p">,</span> <span class="n">info_m0</span><span class="p">,</span> <span class="n">config_m0</span><span class="p">,</span>
                            <span class="n">states_m2</span><span class="p">,</span> <span class="n">spikes_m2</span><span class="p">,</span> <span class="n">info_m2</span><span class="p">,</span> <span class="n">config_m2</span><span class="p">,</span>
                            <span class="n">states_m0_nospike</span><span class="p">,</span> <span class="n">info_m0_nospike</span><span class="p">,</span> <span class="n">config_m0_nospike</span><span class="p">,</span> <span class="n">states_m1_nospike</span><span class="p">,</span> <span class="n">info_m1_nospike</span><span class="p">,</span>
                            <span class="n">config_m1_nospike</span><span class="p">,</span> <span class="n">states_m2_nospike</span><span class="p">,</span> <span class="n">info_m2_nospike</span><span class="p">,</span> <span class="n">config_m2_nospike</span><span class="p">,</span>
                            <span class="n">traces_example</span><span class="p">,</span> <span class="n">traces_spiking</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">traces_gabazine</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;fig2&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="n">fig3</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">figure3</span><span class="p">(</span><span class="n">spiketimes_nexus</span><span class="p">,</span> <span class="n">unit_id</span><span class="p">,</span> <span class="n">psths_nexus_matlab</span><span class="p">,</span> <span class="n">idx_nexus_responsive</span><span class="p">,</span>
                            <span class="n">idx_nexus_putativeint</span><span class="p">,</span> <span class="n">idx_nexus_putativeint_responsive</span><span class="p">,</span> <span class="n">nexus_responses</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig3</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig3</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;fig3&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">fig4</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">figure4</span><span class="p">(</span><span class="n">spikes_jam_only</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">,</span> <span class="n">config_jam_only</span><span class="p">,</span> <span class="n">states_agg_jam_only</span><span class="p">,</span> <span class="n">info_agg_jam_only</span><span class="p">,</span>
                            <span class="n">spiketimes_nexus</span><span class="p">,</span> <span class="n">traces_playback_aligned</span><span class="p">,</span> <span class="n">traces_nif</span><span class="p">,</span>
                            <span class="n">spiketimes_nif</span><span class="p">,</span> <span class="n">suppr_win</span><span class="p">,</span> <span class="n">img_zf_listening</span><span class="p">,</span> <span class="n">img_bubble</span><span class="p">,</span> <span class="n">img_speaker</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig4</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig4</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;fig4&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">fig5</span><span class="p">,</span> <span class="n">ax5</span> <span class="o">=</span> <span class="n">figure5</span><span class="p">(</span><span class="n">states_jam_only</span><span class="p">,</span> <span class="n">spikes_jam_only</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">,</span> <span class="n">config_jam_only</span><span class="p">,</span>
                            <span class="n">states_jam_ft</span><span class="p">,</span> <span class="n">spikes_jam_ft</span><span class="p">,</span> <span class="n">config_jam_ft</span><span class="p">,</span> <span class="n">info_jam_ft</span><span class="p">,</span>
                            <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">,</span> <span class="n">call_onset_times</span><span class="p">,</span> <span class="n">suppr_win</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig5</span><span class="p">,</span> <span class="n">ax5</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig5</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;fig5&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>  <span class="c1"># supplementary figure sensitivity analysis (weights)</span>
        <span class="n">fig_sens</span><span class="p">,</span> <span class="n">ax_sens</span> <span class="o">=</span> <span class="n">fig_s_sensitivity</span><span class="p">(</span><span class="n">config_name_sens_weights_lo</span><span class="p">,</span> <span class="n">run_id_sens_weights</span><span class="p">,</span> <span class="n">idx_marked_sim</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                                              <span class="n">b_mark_weight_sims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig_sens</span><span class="p">,</span> <span class="n">ax_sens</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig_sens</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;figS4&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>  <span class="c1"># supplementary figure sensitivity analysis (population sizes)</span>
        <span class="n">fig_sens2</span><span class="p">,</span> <span class="n">ax_sens2</span> <span class="o">=</span> <span class="n">fig_s_sensitivity</span><span class="p">(</span><span class="n">config_name_sens_pop_lo</span><span class="p">,</span> <span class="n">run_id_sens_pop</span><span class="p">,</span> <span class="n">idx_marked_sim</span><span class="o">=</span><span class="mi">71</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig_sens2</span><span class="p">,</span> <span class="n">ax_sens2</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig_sens2</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;figS1&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>  <span class="c1"># supplementary figure currents</span>
        <span class="n">fig_curr</span><span class="p">,</span> <span class="n">ax_curr</span> <span class="o">=</span> <span class="n">fig_s_current</span><span class="p">(</span><span class="n">states_curr</span><span class="p">,</span> <span class="n">info_curr</span><span class="p">,</span> <span class="n">config_curr</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig_curr</span><span class="p">,</span> <span class="n">ax_curr</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig_curr</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;figS2&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>  <span class="c1"># supplementary figure post-synaptic currents and potentials</span>
        <span class="n">fig_psp</span><span class="p">,</span> <span class="n">ax_psp</span> <span class="o">=</span> <span class="n">fig_s_psp</span><span class="p">(</span><span class="n">states_psp</span><span class="p">,</span> <span class="n">config_psp</span><span class="p">,</span> <span class="n">info_psp</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig_psp</span><span class="p">,</span> <span class="n">ax_psp</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig_psp</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;figS6&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># supplementary figure pre-spike averages of observed and 3 models + dot plot Vm diff</span>
        <span class="n">fig_psa</span><span class="p">,</span> <span class="n">ax_psa</span> <span class="o">=</span> <span class="n">fig_s_prespike_ramp</span><span class="p">(</span><span class="n">states_ag0</span><span class="p">,</span> <span class="n">spikes_ag0</span><span class="p">,</span> <span class="n">info_ag0</span><span class="p">,</span>
                                              <span class="n">states_ag1</span><span class="p">,</span> <span class="n">spikes_ag1</span><span class="p">,</span> <span class="n">info_ag1</span><span class="p">,</span> <span class="n">states_ag2</span><span class="p">,</span> <span class="n">spikes_ag2</span><span class="p">,</span> <span class="n">info_ag2</span><span class="p">,</span>
                                              <span class="n">states_ag1_lowin</span><span class="p">,</span> <span class="n">spikes_ag1_lowin</span><span class="p">,</span> <span class="n">info_ag1_lowin</span><span class="p">,</span>
                                              <span class="n">states_ag2_lowin</span><span class="p">,</span> <span class="n">spikes_ag2_lowin</span><span class="p">,</span> <span class="n">info_ag2_lowin</span><span class="p">,</span>
                                              <span class="n">traces_spiking</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">traces_gabazine</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig_psa</span><span class="p">,</span> <span class="n">ax_psa</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig_psa</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;figS3&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_plot_fig</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>  <span class="c1"># supplementary figure pre-spike averages of observed and 3 models + dot plot Vm diff</span>
        <span class="n">fig_dep</span><span class="p">,</span> <span class="n">ax_dep</span> <span class="o">=</span> <span class="n">fig_s_depolarized</span><span class="p">(</span><span class="n">traces_playback_aligned</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">format_fig</span><span class="p">(</span><span class="n">fig_dep</span><span class="p">,</span> <span class="n">ax_dep</span><span class="p">,</span> <span class="n">b_remove_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_remove_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">b_make_ticklabel_font_sansserif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_save_figures</span><span class="p">:</span>
            <span class="n">p_io</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">fig_dep</span><span class="p">,</span> <span class="n">pathname_fig</span> <span class="o">+</span> <span class="s1">&#39;figS5&#39;</span><span class="p">,</span> <span class="n">figure_format</span><span class="o">=</span><span class="n">figure_formats</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_fig</span><span class="p">,</span>
                              <span class="n">b_close_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_id&#39;</span><span class="p">],</span> <span class="n">b_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="figure1"><a class="viewcode-back" href="../fig_ms.html#fig_ms.figure1">[docs]</a><span class="k">def</span> <span class="nf">figure1</span><span class="p">(</span><span class="n">states_fw</span><span class="p">,</span> <span class="n">spikes_fw</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">,</span> <span class="n">states_hy</span><span class="p">,</span> <span class="n">info_hy</span><span class="p">,</span> <span class="n">states_ag</span><span class="p">,</span> <span class="n">spikes_ag</span><span class="p">,</span> <span class="n">info_ag</span><span class="p">,</span> <span class="n">traces_rec_example</span><span class="p">,</span>
            <span class="n">spiketimes_rec_int</span><span class="p">,</span> <span class="n">traces_rec_spiking</span><span class="p">,</span> <span class="n">spiketimes_rec_spiking</span><span class="p">,</span> <span class="n">img_zf_calling</span><span class="p">,</span> <span class="n">img_bubble</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">i_rows_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">i_cols_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">n_cols_trc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">i_cols_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
    <span class="n">n_cols_crc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">i_col_psth</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">n_cols_psth</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_rows_default</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x_lim_traces</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">]</span>
    <span class="n">x_lim_psths</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">]</span>
    <span class="n">y_lim_traces</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">74</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">65</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">)]</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">color_map_rec</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS_LIGHT</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="n">color_map_trc</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> \
        <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="c1"># file, population &amp; trace indices</span>
    <span class="n">playback_onset_mod</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">samp_freq_rec</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">id_rec_files</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># 1-based indexing</span>
    <span class="n">idx_rec_trc_oi</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">rec_offset_ms_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
    <span class="n">rec_offset_ms_int</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spiketimes_rec_int</span><span class="p">)</span>
    <span class="n">idx_mon_oi_mod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">idx_pop_oi_mod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">idx_nrn_oi_mod_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">letter_pop_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_v}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="n">dur_prespike</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">n_rec_traces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_rec_files</span><span class="p">)</span>
    <span class="n">artificial_spike_heights</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_rec_traces</span> <span class="o">+</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># get absolute from relative model neuron indices</span>
    <span class="n">idx_nrn_oi_mod_abs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_nrn_oi_mod_rel</span><span class="p">)):</span>
        <span class="n">idx_nrn_oi_mod_abs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="n">idx_nrn_oi_mod_rel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">idx_pop_oi_mod</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                  <span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">]))</span>

    <span class="c1"># collect traces</span>
    <span class="n">traces_fw</span><span class="p">,</span> <span class="n">samp_freq_fw</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_fw</span><span class="p">,</span> <span class="n">b_keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traces_hy</span><span class="p">,</span> <span class="n">samp_freq_hy</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_hy</span><span class="p">,</span> <span class="n">b_keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="p">[</span><span class="n">traces_rec_example</span><span class="p">[</span><span class="n">id_rec_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">idx_rec_trc_oi</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
              <span class="n">traces_rec_example</span><span class="p">[</span><span class="n">id_rec_files</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">idx_rec_trc_oi</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
              <span class="n">traces_rec_example</span><span class="p">[</span><span class="n">id_rec_files</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">idx_rec_trc_oi</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
              <span class="n">traces_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
              <span class="n">traces_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
              <span class="n">traces_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
              <span class="n">traces_hy</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
    <span class="n">spiketimes_trc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_rec_traces</span> <span class="o">+</span> \
                     <span class="p">[</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="kc">None</span><span class="p">]</span>
    <span class="n">samp_freqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">samp_freq_rec</span><span class="p">,</span> <span class="n">samp_freq_rec</span><span class="p">,</span> <span class="n">samp_freq_rec</span><span class="p">,</span> <span class="n">samp_freq_fw</span><span class="p">,</span> <span class="n">samp_freq_fw</span><span class="p">,</span> <span class="n">samp_freq_fw</span><span class="p">,</span> <span class="n">samp_freq_hy</span><span class="p">]</span>
    <span class="n">offset_ms</span> <span class="o">=</span> <span class="n">rec_offset_ms_trc</span> <span class="o">+</span> <span class="p">[</span><span class="n">playback_onset_mod</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">ax_trc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_crc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_psth</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region call-marker axis ###################################################################################</span>
    <span class="n">y_lim_call</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax_call</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_trc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">sine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="o">*</span> <span class="mi">50</span> <span class="o">-</span> <span class="mf">0.05</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="n">sine</span> <span class="o">*</span> <span class="n">gauss</span> <span class="o">/</span> <span class="mf">2.1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="c1"># embed zebra finch image</span>
    <span class="n">ax_call_bbox</span> <span class="o">=</span> <span class="n">ax_call</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
    <span class="n">ax_call_axes_ratio</span> <span class="o">=</span> <span class="n">ax_call_bbox</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">ax_call_bbox</span><span class="o">.</span><span class="n">height</span>
    <span class="n">ax_call_data_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_lim_call</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">inset_height</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">correction_factor</span> <span class="o">=</span> <span class="mf">0.888888</span>  <span class="c1"># apparrently axis gets stretched in finale saved image. this corrects for that</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_zf_calling</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                                                                <span class="o">+</span> <span class="n">correction_factor</span> <span class="o">*</span> <span class="n">inset_height</span> <span class="o">*</span> <span class="n">ax_call_data_ratio</span> <span class="o">/</span> <span class="n">ax_call_axes_ratio</span><span class="p">,</span>
                                                                                <span class="mi">0</span><span class="p">,</span> <span class="n">inset_height</span><span class="p">))</span>
    <span class="n">ax_inset_img</span> <span class="o">=</span> <span class="n">ax_call</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">((</span><span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_call</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
    <span class="n">ax_inset_img</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_bubble</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">))</span>
    <span class="n">ax_inset_img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_inset_img</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># plot sound wave</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;Call production&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_traces</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_call</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># plot fake x-axis from call onset onwards</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">xt</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span>
        <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">xt</span><span class="p">,</span> <span class="n">xt</span><span class="p">),</span> <span class="p">(</span><span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Observed neurons&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">,</span> <span class="s1">&#39;(data from Benichov \&amp; Vallentin, 2020)&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_XXS</span><span class="p">,</span>
                 <span class="n">transform</span><span class="o">=</span><span class="n">ax_call</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot traces ########################################################################################</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traces</span><span class="p">):</span>
        <span class="c1"># add artificial spikes by increasing the potential value at spiketimes by a predefined amount</span>
        <span class="k">if</span> <span class="n">artificial_spike_heights</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">spk</span> <span class="ow">in</span> <span class="n">spiketimes_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">samp_spike</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spk</span> <span class="o">/</span> <span class="p">(</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">)))</span>
                <span class="n">trc</span><span class="p">[</span><span class="n">samp_spike</span><span class="p">]</span> <span class="o">=</span> <span class="n">trc</span><span class="p">[</span><span class="n">samp_spike</span><span class="p">]</span> <span class="o">+</span> <span class="n">artificial_spike_heights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># plot trace</span>
        <span class="n">ax_trc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_trc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
        <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">trc</span><span class="o">.</span><span class="n">size</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">trc</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_rec_traces</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                           <span class="p">(</span><span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">trc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="c1"># format axis</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_traces</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i_rows_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">n_rows</span> <span class="o">-</span> <span class="n">n_rows_default</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from call onset [ms]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i_rows_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model neurons&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot neuron descriptions ###########################################################################</span>
    <span class="n">text_nrn</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Predicted Vocal-related Input Neuron&#39;</span><span class="p">,</span> <span class="s1">&#39;Inhibitory Interneuron&#39;</span><span class="p">,</span> <span class="s1">&#39;Premotor Neuron&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Premotor Neuron (silent)&#39;</span><span class="p">]</span>
    <span class="n">i_txt_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">i_mod_trc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_rec_traces</span><span class="p">,</span> <span class="n">n_rec_traces</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_nrn</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_nrn</span><span class="p">):</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i_mod_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_lim_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i_mod_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">1</span><span class="p">],</span> <span class="n">text_nrn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                  <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                  <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="n">i_txt_color</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot circuit diagrams ##############################################################################</span>
    <span class="c1"># new diagrams (full diagrams plotted for each; only relevant elements highlighted):</span>
    <span class="n">x_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
    <span class="n">y_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]</span>
    <span class="n">conn_circ</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
                 <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">]]</span>
    <span class="n">pop_gray</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">color_circ</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pop_gray</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
               <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
               <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
               <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
    <span class="n">color_conn</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]</span>
    <span class="n">ramp_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="p">[</span><span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="n">rectangles</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="n">x_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)):</span>
        <span class="n">ax_crc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_crc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_crc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
        <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_type</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">letters</span><span class="o">=</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">currents</span><span class="o">=</span><span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_lim_crc</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="n">y_lim_crc</span><span class="p">,</span>
                        <span class="n">letter_size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">region_rectangle_xywh</span><span class="o">=</span><span class="n">rectangles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">region_label</span><span class="o">=</span><span class="s1">&#39;HVC&#39;</span><span class="p">,</span>
                        <span class="n">connection_colors</span><span class="o">=</span><span class="n">color_conn</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot psth of predicted sensorimotor population #####################################################</span>
    <span class="n">ax_psth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_col_psth</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
    <span class="n">spiketimes_aud</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_spiketimes_from_monitor</span><span class="p">(</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">info_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">t_values_aud</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_aud_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_aud</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_psths</span><span class="p">([</span><span class="n">v</span> <span class="o">-</span> <span class="n">playback_onset_mod</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_values_aud</span><span class="p">],</span> <span class="n">psths_smooth</span><span class="o">=</span><span class="n">psth_aud_smooth</span><span class="p">,</span>
                      <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot psth of interneurons with comparison to recorded interneurons #################################</span>
    <span class="n">ax_psth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i_col_psth</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
    <span class="n">spiketimes_int</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_spiketimes_from_monitor</span><span class="p">(</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">info_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">t_int_mod</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_int_mod_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_int</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
    <span class="n">t_int_rec_offset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_int_rec_smooth</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spiketimes_rec_int_cur</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spiketimes_rec_int</span><span class="p">):</span>
        <span class="n">t_tmp</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_tmp_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_rec_int_cur</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
        <span class="n">t_int_rec_offset</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v</span> <span class="o">-</span> <span class="n">rec_offset_ms_int</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_tmp</span><span class="p">])</span>
        <span class="n">psth_int_rec_smooth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psth_tmp_smooth</span><span class="p">)</span>
    <span class="n">t_int_all</span> <span class="o">=</span> <span class="n">t_int_rec_offset</span> <span class="o">+</span> <span class="p">[[</span><span class="n">v</span> <span class="o">-</span> <span class="n">playback_onset_mod</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_int_mod</span><span class="p">]]</span>
    <span class="n">psth_int_smooth_all</span> <span class="o">=</span> <span class="n">psth_int_rec_smooth</span> <span class="o">+</span> <span class="p">[</span><span class="n">psth_int_mod_smooth</span><span class="p">]</span>
    <span class="n">n_int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spiketimes_rec_int</span><span class="p">)</span>
    <span class="n">color_rec</span> <span class="o">=</span> <span class="p">[[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">color_map_rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.3501</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_psths</span><span class="p">(</span><span class="n">t_int_all</span><span class="p">,</span> <span class="n">psths_smooth</span><span class="o">=</span><span class="n">psth_int_smooth_all</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">n_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span> <span class="o">+</span>
                             <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">n_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span>
                      <span class="n">colors</span><span class="o">=</span><span class="n">color_rec</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_int_rec_offset</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from call onset [ms]&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_psth</span><span class="p">)):</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike rate [Hz]&#39;</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot prespike average of recorded premotor neurons and model neuron (100 run random current average)</span>
    <span class="n">ax_psa</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">i_col_psth</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># get and plot recorded traces preceding and aligned to first spike</span>
    <span class="n">smoothed_prespike_averages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_traces_in_prespike_avg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traces_rec_spiking</span><span class="p">)):</span>
        <span class="n">smoothed_timeseries_average</span><span class="p">,</span> <span class="n">smoothed_timeseries_all</span><span class="p">,</span> <span class="n">n_traces_included</span> <span class="o">=</span> \
            <span class="n">p_analysis</span><span class="o">.</span><span class="n">prespike_trace_average</span><span class="p">(</span><span class="n">traces_rec_spiking</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">spiketimes_rec_spiking</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">duration</span><span class="o">=</span><span class="n">dur_prespike</span><span class="p">)</span>
        <span class="n">smoothed_prespike_averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_average</span><span class="p">)</span>
        <span class="n">n_traces_in_prespike_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_traces_included</span><span class="p">)</span>
        <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freq_rec</span>
        <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">smoothed_timeseries_average</span><span class="o">.</span><span class="n">size</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">smoothed_timeseries_average</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">h_rec</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_psa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">smoothed_timeseries_average</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># get and plot prespike average of aggregate model data</span>
    <span class="n">spiketimes_ms_ag</span> <span class="o">=</span> <span class="p">[</span><span class="n">p_util</span><span class="o">.</span><span class="n">get_spiketimes_from_monitor</span><span class="p">(</span><span class="n">spikes_ag</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">info_ag</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes_ag</span><span class="p">))]</span>
    <span class="n">traces_ag</span><span class="p">,</span> <span class="n">samp_freq_ag</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_ag</span><span class="p">)</span>
    <span class="c1"># get prespike trace average</span>
    <span class="n">smoothed_timeseries_ag_avg</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">n_traces_included</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">prespike_trace_average</span><span class="p">(</span>
        <span class="p">[</span><span class="n">traces_ag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">mV</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traces_ag</span><span class="p">))],</span>
        <span class="p">[</span><span class="n">spiketimes_ms_ag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spiketimes_ms_ag</span><span class="p">))],</span> <span class="n">duration</span><span class="o">=</span><span class="n">dur_prespike</span><span class="p">,</span>
        <span class="n">b_spiketime_is_onset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sampling_frequency_khz</span><span class="o">=</span><span class="n">samp_freq_ag</span><span class="p">,</span> <span class="n">b_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">smoothed_prespike_averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_ag_avg</span><span class="p">)</span>
    <span class="n">n_traces_in_prespike_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_traces_included</span><span class="p">)</span>
    <span class="c1"># plot aggregate model prespike average</span>
    <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freq_ag</span>
    <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">smoothed_timeseries_ag_avg</span><span class="o">.</span><span class="n">size</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">smoothed_timeseries_ag_avg</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">h_mod</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_psa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">smoothed_timeseries_ag_avg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">y_lim_psa</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">smoothed_prespike_averages</span><span class="p">])</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">(</span><span class="n">h_rec</span><span class="p">,</span> <span class="n">h_mod</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">))</span>
    <span class="n">ax_psa</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">dur_prespike</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax_psa</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_psa</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from first spike [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]</span><span class="se">\n</span><span class="s1">relative to spike onset&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax_call</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_trc</span> <span class="o">+</span> <span class="n">ax_crc</span> <span class="o">+</span> <span class="n">ax_psth</span> <span class="o">+</span> <span class="p">[</span><span class="n">ax_psa</span><span class="p">]</span></div>


<div class="viewcode-block" id="figure2"><a class="viewcode-back" href="../fig_ms.html#fig_ms.figure2">[docs]</a><span class="k">def</span> <span class="nf">figure2</span><span class="p">(</span><span class="n">states_fw</span><span class="p">,</span> <span class="n">spikes_fw</span><span class="p">,</span> <span class="n">info_fw</span><span class="p">,</span> <span class="n">config_fw</span><span class="p">,</span> <span class="n">states_m0</span><span class="p">,</span> <span class="n">spikes_m0</span><span class="p">,</span> <span class="n">info_m0</span><span class="p">,</span> <span class="n">config_m0</span><span class="p">,</span>
            <span class="n">states_m2</span><span class="p">,</span> <span class="n">spikes_m2</span><span class="p">,</span> <span class="n">info_m2</span><span class="p">,</span> <span class="n">config_m2</span><span class="p">,</span>
            <span class="n">states_m0_nospike</span><span class="p">,</span> <span class="n">info_m0_nospike</span><span class="p">,</span> <span class="n">config_m0_nospike</span><span class="p">,</span> <span class="n">states_m1_nospike</span><span class="p">,</span> <span class="n">info_m1_nospike</span><span class="p">,</span>
            <span class="n">config_m1_nospike</span><span class="p">,</span> <span class="n">states_m2_nospike</span><span class="p">,</span> <span class="n">info_m2_nospike</span><span class="p">,</span> <span class="n">config_m2_nospike</span><span class="p">,</span>
            <span class="n">traces_rec_example</span><span class="p">,</span> <span class="n">traces_spiking</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">traces_gabazine</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">23</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">i_rows_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
    <span class="n">i_cols_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">n_cols_trc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">i_cols_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
    <span class="n">n_cols_crc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">i_rows_crc_big</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">i_cols_crc_big</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_crc_big</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_cols_crc_big</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_tpr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">i_cols_tpr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
    <span class="n">n_rows_tpr</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_tpr</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_lat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">i_cols_lat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
    <span class="n">n_rows_lat</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_lat</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">]</span>
    <span class="n">i_cols_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">]</span>
    <span class="n">n_rows_psa</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_psa</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">n_rows_default</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x_lim_traces</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span>
    <span class="n">y_lim_traces</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># file, population &amp; trace indices</span>
    <span class="n">playback_onset_mod</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">samp_freq_rec</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">id_rec_files</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># 1-based indexing</span>
    <span class="n">idx_rec_trc_oi</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">rec_offset_ms_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    <span class="n">idx_mon_oi_mod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
    <span class="n">idx_pop_oi_mod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">idx_nrn_oi_mod_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">letter_pop_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_v}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="n">n_rec_traces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_rec_files</span><span class="p">)</span>
    <span class="n">artificial_spike_heights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_rec_traces</span>
    <span class="n">dur_prespike</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">t1_prespike</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># this minus dur_prespike in the plot; same for t2</span>
    <span class="n">t2_prespike</span> <span class="o">=</span> <span class="n">dur_prespike</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="n">colormap_traces</span> <span class="o">=</span> <span class="s1">&#39;plasma&#39;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap_traces</span><span class="p">)</span>

    <span class="c1"># customize colormap</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)])</span>
    <span class="n">cm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.622</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
    <span class="n">cmext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">cmext</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.86</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">cmext</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cmext</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">cmnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cmext</span><span class="p">,</span> <span class="n">cm</span><span class="p">))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cmnew</span><span class="p">)</span>

    <span class="n">color_map_rec</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS_LIGHT</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="c1"># note: first two runs left out =&gt; remove &quot;-2&quot; to undo</span>
    <span class="n">color_map_trc</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">states_m0_nospike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)),</span>  <span class="c1"># same as colormap</span>
                     <span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">states_m0_nospike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)),</span>
                     <span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">states_m1_nospike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)),</span>
                     <span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">states_m1_nospike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)),</span>
                     <span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">states_m2_nospike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)),</span>
                     <span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">states_m2_nospike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))]</span> <span class="o">+</span> <span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
    <span class="c1"># color_map_trc = color_map_mod[3:5] + color_map_mod[3:5] + color_map_mod[3:5] + color_map_rec[3:5]  # blue/orange</span>

    <span class="c1"># get absolute from relative model neuron indices</span>
    <span class="n">idx_nrn_oi_mod_abs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pop_szs</span> <span class="o">=</span> <span class="p">[</span><span class="n">info_m0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">info_m2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
              <span class="p">[</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_nrn_oi_mod_rel</span><span class="p">)):</span>
        <span class="n">idx_nrn_oi_mod_abs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="n">idx_nrn_oi_mod_rel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">idx_pop_oi_mod</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pop_szs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="c1"># collect traces</span>
    <span class="n">traces_fw</span><span class="p">,</span> <span class="n">samp_freq_fw</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_fw</span><span class="p">,</span> <span class="n">b_keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traces_m0</span><span class="p">,</span> <span class="n">samp_freq_m0</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_m0</span><span class="p">,</span> <span class="n">b_keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traces_m2</span><span class="p">,</span> <span class="n">samp_freq_m2</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_m2</span><span class="p">,</span> <span class="n">b_keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="p">[</span><span class="n">traces_m0</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
              <span class="n">traces_m0</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
              <span class="n">traces_m2</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
              <span class="n">traces_m2</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
              <span class="n">traces_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
              <span class="n">traces_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span>
              <span class="n">traces_rec_example</span><span class="p">[</span><span class="n">id_rec_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">idx_rec_trc_oi</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
              <span class="n">traces_rec_example</span><span class="p">[</span><span class="n">id_rec_files</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">idx_rec_trc_oi</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
    <span class="n">spiketimes_trc</span> <span class="o">=</span> <span class="p">[</span><span class="n">spikes_m0</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_m0</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_m0</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_m0</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_m2</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_m2</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_m2</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_m2</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_fw</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                      <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="c1"># note: first two runs left out =&gt; remove &quot;-2&quot; to undo</span>
    <span class="n">inh_weights</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">info_m0</span><span class="p">[</span><span class="mi">2</span><span class="p">:][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_m0</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">info_m0</span><span class="p">[</span><span class="mi">2</span><span class="p">:][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_m0</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">info_fw</span><span class="p">[</span><span class="mi">2</span><span class="p">:][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_fw</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">info_fw</span><span class="p">[</span><span class="mi">2</span><span class="p">:][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_fw</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">info_m2</span><span class="p">[</span><span class="mi">2</span><span class="p">:][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_m2</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">info_m2</span><span class="p">[</span><span class="mi">2</span><span class="p">:][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_m2</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">]</span>
    <span class="n">samp_freqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">samp_freq_m0</span><span class="p">,</span> <span class="n">samp_freq_m0</span><span class="p">,</span> <span class="n">samp_freq_fw</span><span class="p">,</span> <span class="n">samp_freq_fw</span><span class="p">,</span> <span class="n">samp_freq_m0</span><span class="p">,</span> <span class="n">samp_freq_m0</span><span class="p">,</span>
                  <span class="n">samp_freq_rec</span><span class="p">,</span> <span class="n">samp_freq_rec</span><span class="p">]</span>
    <span class="n">offset_ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">playback_onset_mod</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">rec_offset_ms_trc</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">ax_trc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_crc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_crc_big</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_tpr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_psa</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region plot traces ########################################################################################</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traces</span><span class="p">):</span>
        <span class="c1"># add artificial spikes by increasing the potential value at spiketimes by a predefined amount</span>
        <span class="k">if</span> <span class="n">artificial_spike_heights</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">spk</span> <span class="ow">in</span> <span class="n">spiketimes_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">samp_spike</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spk</span> <span class="o">/</span> <span class="p">(</span><span class="n">info_fw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">)))</span>
                <span class="n">trc</span><span class="p">[</span><span class="n">samp_spike</span><span class="p">]</span> <span class="o">=</span> <span class="n">trc</span><span class="p">[</span><span class="n">samp_spike</span><span class="p">]</span> <span class="o">+</span> <span class="n">artificial_spike_heights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># plot trace</span>
        <span class="n">ax_trc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_trc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
        <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">trc</span><span class="o">.</span><span class="n">size</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">trc</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">trc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="c1"># format axis</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_traces</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># remove xticklabels from every second plot (upper trace in each subfigure)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from call onset [ms]&#39;</span><span class="p">)</span>
        <span class="c1"># print inhibitory weights</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">inh_weights</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">+</span> <span class="s1">&#39; pA&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                           <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;gabazine&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">,</span> <span class="s1">&#39;Observed neurons&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_L</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mf">1.12</span><span class="p">,</span> <span class="s1">&#39;(data from Benichov \&amp; Vallentin, 2020)&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_XXS</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_trc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model neurons&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot small circuit diagrams next to traces #########################################################</span>
    <span class="c1"># alternative diagram with no-inhibition model PMs receiving motor-related input as well</span>
    <span class="n">x_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
    <span class="n">y_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]</span>
    <span class="n">conn_circ</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
                 <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
                 <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]]</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]]</span>
    <span class="n">conn_linestyle</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]]</span>
    <span class="n">color_circ</span> <span class="o">=</span> <span class="p">[[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_trc</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_trc</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">color_map_trc</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">color_map_trc</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_trc</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_trc</span><span class="p">[</span><span class="mi">5</span><span class="p">]]]</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="p">[[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]]]</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)</span>
    <span class="c1"># set axis limits and plot</span>
    <span class="n">x_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)):</span>
        <span class="n">ax_crc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_crc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_crc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
        <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_type</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">letters</span><span class="o">=</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">currents</span><span class="o">=</span><span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_lim_crc</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="n">y_lim_crc</span><span class="p">,</span>
                        <span class="n">letter_size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">conn_linestyle</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot big circuit diagrams on top ###################################################################</span>
    <span class="c1"># alternative diagram with no-inhibition model PMs receiving motor-related input as well</span>
    <span class="n">x_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
    <span class="n">y_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]]</span>
    <span class="n">conn_circ</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]]</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]</span>
    <span class="n">conn_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">]]</span>
    <span class="n">color_circ</span> <span class="o">=</span> <span class="p">[[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="p">[[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
    <span class="n">ramp_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="c1"># set axis limits and plot</span>
    <span class="n">x_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.7</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">y_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="n">text_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;No inhibition&#39;</span><span class="p">,</span> <span class="s1">&#39;Tonic inhibition&#39;</span><span class="p">,</span> <span class="s1">&#39;Feed-forward</span><span class="se">\n</span><span class="s1">inhibition&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)):</span>
        <span class="n">ax_crc_big</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                           <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_crc_big</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_crc_big</span><span class="p">))</span>
        <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_type</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">letters</span><span class="o">=</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">currents</span><span class="o">=</span><span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_lim_crc</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="n">y_lim_crc</span><span class="p">,</span>
                        <span class="n">letter_size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">,</span> <span class="n">connection_colors</span><span class="o">=</span><span class="n">conn_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.555</span><span class="p">,</span> <span class="n">text_mod</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_M</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot traces per run without spike threshold ##############################################</span>
    <span class="n">spike_threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">40</span>
    <span class="c1"># note: first two runs left out</span>
    <span class="n">statemons</span> <span class="o">=</span> <span class="p">[</span><span class="n">states_m0_nospike</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">states_m2_nospike</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">states_m1_nospike</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
    <span class="n">configs</span> <span class="o">=</span> <span class="p">[</span><span class="n">config_m0_nospike</span><span class="p">,</span> <span class="n">config_m2_nospike</span><span class="p">,</span> <span class="n">config_m1_nospike</span><span class="p">]</span>
    <span class="n">infos</span> <span class="o">=</span> <span class="p">[</span><span class="n">info_m0_nospike</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">info_m2_nospike</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">info_m1_nospike</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
    <span class="n">pops_oi</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">xlims_tpr_lat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statemons</span><span class="p">)):</span>
        <span class="n">ax_tpr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_tpr</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_tpr</span><span class="p">))</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_traces_per_run</span><span class="p">(</span><span class="n">statemons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">configs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b_spike_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth_traces</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">neuron_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">population_idx</span><span class="o">=</span><span class="n">pops_oi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">t_offset_ms</span><span class="o">=</span><span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                   <span class="n">colormap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlims_tpr_lat</span><span class="p">,</span> <span class="p">[</span><span class="n">spike_threshold</span><span class="p">,</span> <span class="n">spike_threshold</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelright</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims_tpr_lat</span><span class="p">)</span>
        <span class="n">nrn_idx_abs</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pops_oi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
        <span class="n">i_plot_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xlims_tpr_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">statemons</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i_plot_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xlims_tpr_lat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">statemons</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">statemons</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">nrn_idx_abs</span><span class="p">,</span> <span class="n">i_plot_l</span><span class="p">:</span><span class="n">i_plot_r</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">statemons</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">nrn_idx_abs</span><span class="p">,</span> <span class="n">i_plot_l</span><span class="p">:</span><span class="n">i_plot_r</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;regular&#39;</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot latency of first spike versus inhibitory weights ##############################################</span>
    <span class="c1"># note: first two runs left out</span>
    <span class="n">spikemons</span> <span class="o">=</span> <span class="p">[</span><span class="n">spikes_m0</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">spikes_m2</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">spikes_fw</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
    <span class="n">configs</span> <span class="o">=</span> <span class="p">[</span><span class="n">config_m0</span><span class="p">,</span> <span class="n">config_m2</span><span class="p">,</span> <span class="n">config_fw</span><span class="p">]</span>
    <span class="n">infos</span> <span class="o">=</span> <span class="p">[</span><span class="n">info_m0</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">info_m2</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">info_fw</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
    <span class="n">pops_oi</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx_pop_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_pop_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">idx_pop_oi_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
    <span class="n">syn_oi</span> <span class="o">=</span> <span class="p">[</span><span class="n">config_m0</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">],</span> <span class="n">config_m2</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">],</span>
              <span class="n">config_fw</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikemons</span><span class="p">)):</span>
        <span class="n">nrn_idx_abs</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pops_oi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
        <span class="n">ax_lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_lat</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_lat</span><span class="p">))</span>
        <span class="n">idx_colored</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikemons</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>  <span class="c1"># all dots in viridis</span>
        <span class="n">colors_lat</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikemons</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_t_first_spike_1d</span><span class="p">(</span><span class="n">spikemons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">configs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nrn_idx_abs</span><span class="p">,</span> <span class="n">syn_oi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">param_unit</span><span class="o">=</span><span class="n">b2</span><span class="o">.</span><span class="n">pA</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="n">configs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;misc&#39;</span><span class="p">][</span><span class="s1">&#39;playback_start&#39;</span><span class="p">],</span>
                                     <span class="n">idx_mons_colored</span><span class="o">=</span><span class="n">idx_colored</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors_lat</span><span class="p">,</span> <span class="n">dot_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims_tpr_lat</span><span class="p">)</span>
        <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Inhibitory</span><span class="se">\n</span><span class="s1">weights [pA]&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;regular&#39;</span><span class="p">)</span>
        <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time of first spike [ms]&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;regular&#39;</span><span class="p">)</span>
        <span class="c1"># connecting lines between threshoold crossings and dots on latency plot. * 1000 to go from Amp to pA</span>
        <span class="n">t_first_spike</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_t_first_spike_mod</span><span class="p">(</span><span class="n">spikemons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nrn_idx_abs</span><span class="p">)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_first_spike</span><span class="p">):</span>
            <span class="n">x_t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">con</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">ConnectionPatch</span><span class="p">(</span><span class="n">xyA</span><span class="o">=</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">spike_threshold</span><span class="p">),</span>
                                                          <span class="n">xyB</span><span class="o">=</span><span class="p">(</span>
                                                          <span class="n">x_t</span><span class="p">,</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">syn_oi</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
                                                          <span class="n">coordsA</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">coordsB</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">axesA</span><span class="o">=</span><span class="n">ax_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                          <span class="n">axesB</span><span class="o">=</span><span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                          <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_first_spike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))))</span>
        <span class="c1"># plot connections in reversed order (i.e. same plotting order as traces above)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">con</span><span class="p">)):</span>
            <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="c1"># plot arrows marking the example traces and the corresponding inhibitory weights</span>
        <span class="c1"># note: first two runs left out =&gt; remove &quot;-2&quot; to undo</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">inh_weight</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">syn_oi</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">arr_x_start</span> <span class="o">=</span> <span class="n">t_first_spike</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">4.5</span>
            <span class="n">arr_y_start</span> <span class="o">=</span> <span class="n">inh_weight</span> <span class="o">+</span> <span class="mf">3.5</span>
            <span class="n">arr_color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">((</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_first_spike</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">arr_x_start</span><span class="p">,</span> <span class="n">arr_y_start</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
                            <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arr_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">arr_color</span><span class="p">)</span>
            <span class="n">ax_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">arr_x_start</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">arr_y_start</span> <span class="o">+</span> <span class="mf">2.5</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">inh_weight</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39; pA&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                           <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">arr_color</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XS</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot prespike averages of recorded premotor neurons and model neurons (100 run random current avg.)</span>
    <span class="n">traces_rec_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">traces_spiking</span><span class="p">,</span> <span class="n">traces_gabazine</span><span class="p">]</span>
    <span class="n">spiketimes_rec_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">]</span>
    <span class="n">i_traces_rec_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">i_spiketimes_rec_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">i_colors_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_cols_psa</span><span class="p">)):</span>
        <span class="n">ax_psa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_psa</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">i_cols_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psa</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_psa</span><span class="p">))</span>
        <span class="n">y_lim_psa</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">dur_prespike</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_psa</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from first spike [ms]&#39;</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]</span><span class="se">\n</span><span class="s1">rel. to spike onset&#39;</span><span class="p">)</span>
        <span class="c1"># for every second plot remove y axis labels</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_cols_psa</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># get and plot recorded traces preceding and aligned to first spike</span>
    <span class="n">h_rec_all</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">h_avg_all</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">averages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_traces_rec_psa</span><span class="p">)):</span>
        <span class="n">i_ax</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set to c to plot in 2 separate axes</span>
        <span class="n">smoothed_prespike_averages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_traces_in_prespike_avg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traces_rec_all</span><span class="p">[</span><span class="n">i_traces_rec_psa</span><span class="p">[</span><span class="n">c</span><span class="p">]])):</span>
            <span class="n">smoothed_timeseries_average</span><span class="p">,</span> <span class="n">smoothed_timeseries_all</span><span class="p">,</span> <span class="n">n_traces_included</span> <span class="o">=</span> \
                <span class="n">p_analysis</span><span class="o">.</span><span class="n">prespike_trace_average</span><span class="p">(</span><span class="n">traces_rec_all</span><span class="p">[</span><span class="n">i_traces_rec_psa</span><span class="p">[</span><span class="n">c</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                                                  <span class="n">spiketimes_rec_all</span><span class="p">[</span><span class="n">i_spiketimes_rec_psa</span><span class="p">[</span><span class="n">c</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">duration</span><span class="o">=</span><span class="n">dur_prespike</span><span class="p">)</span>
            <span class="n">smoothed_prespike_averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_average</span><span class="p">)</span>
            <span class="n">n_traces_in_prespike_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_traces_included</span><span class="p">)</span>
            <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freq_rec</span>
            <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">smoothed_timeseries_average</span><span class="o">.</span><span class="n">size</span>
            <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">smoothed_timeseries_average</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">h_rec</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_psa</span><span class="p">[</span><span class="n">i_ax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">smoothed_timeseries_average</span><span class="p">,</span>
                                       <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">smoothed_prespike_averages</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">h_rec_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_rec</span><span class="p">)</span>
    <span class="c1"># plot averages</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_traces_rec_psa</span><span class="p">)):</span>
        <span class="n">h_avg</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_psa</span><span class="p">[</span><span class="n">i_ax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">averages</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
                                   <span class="n">color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">h_avg_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_avg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_cols_psa</span><span class="p">)):</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[(</span><span class="n">h_rec_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h_rec_all</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">h_avg_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h_avg_all</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
                         <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span>
                         <span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">handler_map</span><span class="o">=</span><span class="p">{</span><span class="nb">tuple</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">legend_handler</span><span class="o">.</span><span class="n">HandlerTuple</span><span class="p">(</span><span class="kc">None</span><span class="p">)})</span>
    <span class="c1"># endregion</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_crc_big</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_crc_big</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_crc_big</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.22</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax_trc</span> <span class="o">+</span> <span class="n">ax_crc</span> <span class="o">+</span> <span class="n">ax_crc_big</span> <span class="o">+</span> <span class="n">ax_tpr</span> <span class="o">+</span> <span class="n">ax_lat</span> <span class="o">+</span> <span class="n">ax_psa</span></div>


<div class="viewcode-block" id="figure3"><a class="viewcode-back" href="../fig_ms.html#fig_ms.figure3">[docs]</a><span class="k">def</span> <span class="nf">figure3</span><span class="p">(</span><span class="n">spiketimes_nexus</span><span class="p">,</span> <span class="n">unit_id</span><span class="p">,</span> <span class="n">psths_nexus_matlab</span><span class="p">,</span> <span class="n">idx_nexus_responsive</span><span class="p">,</span> <span class="n">idx_nexus_putativeint</span><span class="p">,</span>
            <span class="n">idx_nexus_putativeint_responsive</span><span class="p">,</span> <span class="n">nexus_responses</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">i_rows_psth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># psths of Neuronexus recordings</span>
    <span class="n">i_cols_psth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">n_cols_psth</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_mtrx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>  <span class="c1"># matrix plot of all nexus psths</span>
    <span class="n">i_cols_mtrx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">n_rows_mtrx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">n_cols_mtrx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">i_rows_line</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>  <span class="c1"># matrix plot of all nexus psths</span>
    <span class="n">i_cols_line</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="n">n_rows_line</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">n_cols_line</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">i_rows_bar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>  <span class="c1"># horizontal bar plot</span>
    <span class="n">i_cols_bar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">n_rows_bar</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">n_cols_bar</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_sum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span>  <span class="c1"># sum of horizontal bar plot</span>
    <span class="n">i_cols_sum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">n_rows_sum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_cols_sum</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_hist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># histogram of baseline activities</span>
    <span class="n">i_cols_hist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">n_rows_hist</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_hist</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">n_rows_default</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">t_baseline_psth_norm</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># for normalizing psths to baseline. Set to None to not normalize</span>
    <span class="n">x_lim_psths</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
    <span class="n">y_lim_psths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="c1"># file, population &amp; trace indices</span>
    <span class="n">id_rec_nrn_nxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">123</span><span class="p">]</span>  <span class="c1"># final (NOTE: this is 1-based index, variables starting with idx_ are 0-based!)</span>
    <span class="n">idx_responsive</span> <span class="o">=</span> <span class="n">idx_nexus_responsive</span><span class="p">[</span><span class="s1">&#39;idx_responsive_neurons_out_of_min20trials&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">idx_putativeint</span> <span class="o">=</span> <span class="n">idx_nexus_putativeint</span><span class="p">[</span><span class="s1">&#39;idx_putative_interneurons_out_of_min20trials&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">idx_putativeint_responsive</span> <span class="o">=</span> \
        <span class="n">idx_nexus_putativeint_responsive</span><span class="p">[</span><span class="s1">&#39;idx_putative_interneurons_responsive_out_of_min20trials&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">pathname_out</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">BASE_PATH_OUTPUT</span> <span class="o">+</span> <span class="s1">&#39;fig&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;fig_ms&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;spiketimes&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> \
        <span class="s1">&#39;nexus_psth&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">ax_psth</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_psth_spks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_mtrx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_cb</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_line</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_bar</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_sum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_hist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region get data of all nexus psths ############################################################################</span>
    <span class="n">b_sort_psths</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># normalize psths as loaded from margarida&#39;s matlab script</span>
    <span class="n">psth_loaded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">psths_nexus_matlab</span><span class="p">[</span><span class="s1">&#39;psth&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">psth_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">psths_nexus_matlab</span><span class="p">[</span><span class="s1">&#39;time_n&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">psth_sem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">psths_nexus_matlab</span><span class="p">[</span><span class="s1">&#39;psth_error&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># shift psths so baseline is at 0, and normalize to absolute maximum (max or min equals 1/-1, whichever larger)</span>
    <span class="n">psth_t_truncated</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_truncated</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_sem_truncated</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psths_nexus_blzero_norm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psths_nexus_blnorm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_sem_blnorm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_baseline_std_norm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_baseline_mean</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">psth_loaded</span><span class="p">):</span>
        <span class="n">samp_baseline_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">psth_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t_baseline_psth_norm</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">samp_baseline_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">psth_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t_baseline_psth_norm</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">baseline_activity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">samp_baseline_start</span><span class="p">:</span><span class="n">samp_baseline_end</span><span class="p">])</span>
        <span class="n">baseline_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">samp_baseline_start</span><span class="p">:</span><span class="n">samp_baseline_end</span><span class="p">])</span>
        <span class="c1"># truncate psths to x_lim_psths (set above)</span>
        <span class="n">samp_xmin_psths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">psth_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">samp_xmax_psths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">psth_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">psth_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">samp_xmin_psths</span><span class="p">:</span><span class="n">samp_xmax_psths</span><span class="p">])</span>
        <span class="n">psth_t_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psth_t</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">samp_xmin_psths</span><span class="p">:</span><span class="n">samp_xmax_psths</span><span class="p">])</span>
        <span class="n">psth_sem_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psth_sem</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">samp_xmin_psths</span><span class="p">:</span><span class="n">samp_xmax_psths</span><span class="p">])</span>
        <span class="n">psth_baseline_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">psth_truncated</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">baseline_activity</span>
        <span class="n">psths_nexus_blzero_norm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psth_baseline_zero</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psth_baseline_zero</span><span class="p">)))</span>
        <span class="n">psths_nexus_blnorm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">psth_truncated</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">baseline_activity</span><span class="p">)</span>
        <span class="n">psth_sem_blnorm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">psth_sem_truncated</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">baseline_activity</span><span class="p">)</span>
        <span class="n">psth_baseline_std_norm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">baseline_std</span> <span class="o">/</span> <span class="n">baseline_activity</span><span class="p">)</span>
        <span class="n">psth_baseline_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">baseline_activity</span><span class="p">)</span>
    <span class="n">psth_to_be_plotted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psths_nexus_blzero_norm</span><span class="p">)</span>
    <span class="n">psth_to_be_plotted_responsive</span> <span class="o">=</span> <span class="n">psth_to_be_plotted</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">idx_responsive</span><span class="p">]</span>
    <span class="n">psth_to_be_plotted_putative_int</span> <span class="o">=</span> <span class="n">psth_to_be_plotted</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">idx_putativeint</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">idx_putativeint_responsive</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">idx_putativeint</span><span class="p">,</span> <span class="n">idx_responsive</span><span class="p">))</span>
    <span class="n">psth_to_be_plotted_putative_int_responsive</span> <span class="o">=</span> <span class="n">psth_to_be_plotted</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">idx_putativeint_responsive</span><span class="p">]</span>
    <span class="n">t_psth_to_be_plotted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psth_t_truncated</span><span class="p">)</span>
    <span class="n">psths_nexus</span> <span class="o">=</span> <span class="n">psth_truncated</span>  <span class="c1"># &quot;raw&quot; psth without normalization</span>
    <span class="n">b_plot_only_putativeint</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">b_plot_only_putativeint</span><span class="p">:</span>
        <span class="n">psth_to_be_plotted</span> <span class="o">=</span> <span class="n">psth_to_be_plotted_putative_int</span>
        <span class="n">psth_to_be_plotted_responsive</span> <span class="o">=</span> <span class="n">psth_to_be_plotted_putative_int_responsive</span>
        <span class="n">idx_responsive</span> <span class="o">=</span> <span class="n">idx_putativeint_responsive</span>

    <span class="c1"># region plot example psths of neuronexus recordings as loaded from margarida&#39;s script #########################</span>
    <span class="n">marker_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.165</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.366</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_nrn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">id_rec_nrn_nxs</span><span class="p">):</span>
        <span class="n">ax_psth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_psth</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                        <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
        <span class="c1"># plot spike raster</span>
        <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spiketimes_nexus</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">dot_color</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">y_trials</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">n_trials</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_trials</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
            <span class="n">spikes_in_trial</span> <span class="o">=</span> <span class="n">spiketimes_nexus</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">trial</span><span class="p">]</span>
            <span class="n">spikes_to_plot</span> <span class="o">=</span> <span class="n">spikes_in_trial</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">spikes_in_trial</span> <span class="o">&gt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                            <span class="n">spikes_in_trial</span> <span class="o">&lt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spikes_to_plot</span><span class="p">,</span> <span class="p">[</span><span class="n">y_trials</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_to_plot</span><span class="p">),</span>
                            <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">dot_color</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax_psth_spks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_trials</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># no 0 tick</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_trials</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">ax_psth_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="c1"># call marker and baseline marker</span>
        <span class="c1"># ax_psth[i].axvline(0, color=[0, 0, 0], linewidth=1.5, linestyle=&#39;:&#39;)</span>
        <span class="c1"># ax_psth[i].axvline(110, color=[0, 0, 0], linewidth=1.5, linestyle=&#39;:&#39;)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">psth_baseline_std_norm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">psth_baseline_std_norm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="c1"># add box marker for playback time</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="mi">110</span><span class="p">,</span> <span class="n">y_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="c1"># plot psth</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">psths_nexus_blnorm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="c1"># plot +-sem error margin as patch</span>
        <span class="n">error_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">psths_nexus_blnorm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">psth_sem_blnorm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="n">psths_nexus_blnorm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">psth_sem_blnorm</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">y_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">error_path</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">error_path</span><span class="p">)])</span>
        <span class="n">x_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_path</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_path</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> \
            <span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">x_path</span><span class="p">,</span> <span class="n">y_path</span><span class="p">])),</span>
                                             <span class="n">facecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_psths</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike rate</span><span class="se">\n</span><span class="s1">rel. to baseline&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_rec_nrn_nxs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="c1"># add number to identify example psth in matrix plot</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">marker_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax_psth_spks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Trials&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dot_color</span><span class="p">)</span>

    <span class="c1"># plot psth matrix</span>
    <span class="n">samp_baseline_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t_baseline_psth_norm</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">samp_baseline_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t_baseline_psth_norm</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">max_psth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psth_to_be_plotted</span><span class="p">))</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reversed</span><span class="p">()</span>
    <span class="c1"># get indices to neurons where avg +/- sem crosses above bl + 2*std or below bl - 2*std</span>
    <span class="n">psths_nexus_blnorm_responsive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psths_nexus_blnorm</span><span class="p">)[</span><span class="n">idx_responsive</span><span class="p">]</span>
    <span class="n">psth_sem_blnorm_responsive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psth_sem_blnorm</span><span class="p">)[</span><span class="n">idx_responsive</span><span class="p">]</span>
    <span class="n">idx_pos_responsive</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">idx_neg_responsive</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">psths_nexus_blnorm_responsive</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">psth_sem_blnorm_responsive</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">psth_baseline_std_norm</span><span class="p">[</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">i</span><span class="p">]]):</span>
            <span class="n">idx_pos_responsive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">psth_sem_blnorm_responsive</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">psth_baseline_std_norm</span><span class="p">[</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">i</span><span class="p">]]):</span>
            <span class="n">idx_neg_responsive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">t_peak</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- responsive neuron ids: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[:]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ax_mtrx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">i_cols_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]),</span>
                                        <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">psth</span> <span class="o">=</span> <span class="n">psth_to_be_plotted</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">psth</span> <span class="o">=</span> <span class="n">psth_to_be_plotted_responsive</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">idx_pos_responsive</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- positive responsive neuron ids: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">psth</span> <span class="o">=</span> <span class="n">psth_to_be_plotted_responsive</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">idx_neg_responsive</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- negative responsive neuron ids: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1"># sort by time of peak</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">idx_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="n">samp_baseline_end</span><span class="p">:]</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">psth</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="n">samp_baseline_end</span><span class="p">:]</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">psth</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sort_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">idx_peak</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sort order neuron ids for plot &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sort_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">running</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">running</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sort_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sort order neuron ids for plot &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sort_order</span><span class="p">))</span>
            <span class="n">sort_order_pos</span> <span class="o">=</span> <span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">running</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">running</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span>
             <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sort order neuron ids for plot &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sort_order</span><span class="p">))</span>
            <span class="n">sort_order_neg</span> <span class="o">=</span> <span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">running</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">running</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span>
             <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">b_sort_psths</span><span class="p">:</span>
            <span class="n">psth_sorted</span> <span class="o">=</span> <span class="n">psth</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">sort_order</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psth_sorted</span> <span class="o">=</span> <span class="n">psth</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># save peak times</span>
        <span class="n">t_peak</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx_peak</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]])</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">psth_sorted</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">max_psth</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_psth</span><span class="p">,</span>
                           <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_psth_to_be_plotted</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth_sorted</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
                                   <span class="mf">0.5</span><span class="p">],</span>
                           <span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="n">max_psth</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_psth</span><span class="p">))</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">psth_sorted</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># add box marker for playback time</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mi">110</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth_sorted</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="c1"># add markers for example psths</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_nrn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">id_rec_nrn_nxs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">id_nrn</span> <span class="ow">in</span> <span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">id_nrn</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">p_plot</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                 <span class="n">head_width_factor</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="mi">230</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">230</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XS</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">id_nrn</span> <span class="ow">in</span> <span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">][</span><span class="n">sort_order</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">id_nrn</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">p_plot</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                 <span class="n">head_width_factor</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="mi">230</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">230</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XS</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="c1"># adjust y-axis tick positions</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth_sorted</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">ax_mtrx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Neuron Nr.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax_mtrx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Neuron Nr.&#39;</span><span class="p">)</span>
    <span class="c1"># add colorbar</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">h_cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="n">max_psth</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_psth</span><span class="p">),</span>
                                         <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax_mtrx</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">drawedges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="n">h_cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized deviation from baseline&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h_cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">ax_cb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_cb</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region baseline activity histogram ################################################################</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_hist</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_hist</span><span class="p">))</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">psth_baseline_mean</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Baseline spike rate [Hz]&#39;</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Nr. of neurons&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region line plot ################################################################</span>
    <span class="n">ax_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">psth</span> <span class="o">=</span> <span class="n">psth_to_be_plotted_responsive</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth</span><span class="p">)),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_peak</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_peak</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_peak</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_peak</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth</span><span class="p">)))</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># playback marker box</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">110</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">box</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Neuron Nr.&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region horizontal bars ###########################################################################################</span>
    <span class="n">idx_mixed_responsive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_neg_responsive</span><span class="p">],</span> <span class="n">idx_responsive</span><span class="p">[</span><span class="n">idx_pos_responsive</span><span class="p">])</span>
    <span class="n">id_strictly_pos_responsive</span> <span class="o">=</span> <span class="n">sort_order_pos</span><span class="p">[[</span><span class="n">sort_order_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx_mixed_responsive</span>
                                                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sort_order_pos</span><span class="p">))]]</span>
    <span class="n">id_strictly_neg_responsive</span> <span class="o">=</span> <span class="n">sort_order_neg</span><span class="p">[[</span><span class="n">sort_order_neg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx_mixed_responsive</span>
                                                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sort_order_neg</span><span class="p">))]]</span>
    <span class="n">idx_strictly_pos_to_sorted_responsive</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sort_order_pos</span> <span class="o">==</span> <span class="n">sp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">id_strictly_pos_responsive</span><span class="p">]</span>
    <span class="n">idx_strictly_neg_to_sorted_responsive</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sort_order_neg</span> <span class="o">==</span> <span class="n">sn</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">id_strictly_neg_responsive</span><span class="p">]</span>
    <span class="n">resp_onsets_strictly_pos_responders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_plus&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_plus&#39;</span><span class="p">]))</span>
                                                    <span class="k">if</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sort_order_pos&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                                                    <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx_strictly_pos_to_sorted_responsive</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">resp_onsets_strictly_neg_responders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_minus&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_minus&#39;</span><span class="p">]))</span>
                                                    <span class="k">if</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sort_order_neg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                                                    <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx_strictly_neg_to_sorted_responsive</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax_bar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_bar</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">i_cols_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_bar</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_bar</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">on_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_plus&#39;</span><span class="p">]</span>
            <span class="n">dur_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;dur_plus&#39;</span><span class="p">]</span>
            <span class="n">order_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sort_order_pos&#39;</span><span class="p">]</span>
            <span class="n">color_cur</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean onset time of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; positive responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">on_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stdev onset time of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; positive responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">on_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean duration of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; positive responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stdev duration of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; positive responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n positive response onsets during playback: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_plus&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">110</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected number (if response onsets uniformly distr. in time): &#39;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="mi">110</span> <span class="o">/</span> <span class="mi">500</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sort_order_pos&#39;</span><span class="p">]))))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n positive response onsets during playback (only strictly positively responding neurons): &#39;</span>
                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">resp_onsets_strictly_pos_responders</span> <span class="o">&lt;=</span> <span class="mi">110</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected number (if response onsets uniformly distr. in time): &#39;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="mi">110</span> <span class="o">/</span> <span class="mi">500</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_strictly_pos_responsive</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">on_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_minus&#39;</span><span class="p">]</span>
            <span class="n">dur_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;dur_minus&#39;</span><span class="p">]</span>
            <span class="n">order_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sort_order_neg&#39;</span><span class="p">]</span>
            <span class="n">color_cur</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean onset time of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; negative responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">on_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stdev onset time of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; negative responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">on_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean duration of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; negative responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stdev duration of all &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; negative responses: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dur_cur</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n negative response onsets during playback: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;on_minus&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">110</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected number (if response onsets uniformly distr. in time): &#39;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="mi">110</span> <span class="o">/</span> <span class="mi">500</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sort_order_neg&#39;</span><span class="p">]))))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n negative response onsets during playback (only strictly negatively responding neurons): &#39;</span>
                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">resp_onsets_strictly_neg_responders</span> <span class="o">&lt;=</span> <span class="mi">110</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected number (if response onsets uniformly distr. in time): &#39;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="mi">110</span> <span class="o">/</span> <span class="mi">500</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_strictly_neg_responsive</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on_cur</span><span class="p">)):</span>
            <span class="n">hor_bar</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">on_cur</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">order_cur</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">),</span> <span class="n">dur_cur</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.6</span><span class="p">,</span>
                                                   <span class="n">color</span><span class="o">=</span><span class="n">color_cur</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">hor_bar</span><span class="p">)</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">order_cur</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.9</span><span class="p">))</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="c1"># ax_bar[a].get_yaxis().set_visible(False)</span>
        <span class="c1"># ax_bar[a].spines[&#39;left&#39;].set_visible(False)</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Neuron Nr.&#39;</span><span class="p">)</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="c1"># add box marker for playback time</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">110</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">order_cur</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="c1"># plot sum of bars</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax_sum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_sum</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">i_cols_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_sum</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_sum</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sum_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sum_pos&#39;</span><span class="p">]</span>
            <span class="n">color_cur</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sum_cur</span> <span class="o">=</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;sum_neg&#39;</span><span class="p">]</span>
            <span class="n">color_cur</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]</span>
        <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="p">(</span><span class="n">sum_cur</span> <span class="o">/</span> <span class="n">nexus_responses</span><span class="p">[</span><span class="s1">&#39;putativeint_eligible_neurons&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_cur</span><span class="p">)</span>
        <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
        <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
        <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">))</span>
    <span class="c1"># endregion</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.95</span> <span class="o">/</span> <span class="n">n_cols_psth</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.65</span> <span class="o">/</span> <span class="n">n_cols_hist</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_mtrx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.19</span> <span class="o">/</span> <span class="n">n_cols_mtrx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.03</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_mtrx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.19</span> <span class="o">/</span> <span class="n">n_cols_mtrx</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">n_cols_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.11</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.19</span> <span class="o">/</span> <span class="n">n_cols_bar</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># adjust position of horizontal bar and sum plots</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax_pos</span> <span class="o">=</span> <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">ax_pos_new</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax_pos</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
        <span class="n">ax_bar</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">ax_pos_new</span><span class="p">)</span>
        <span class="n">ax_pos</span> <span class="o">=</span> <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">ax_pos_new</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax_pos</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mf">0.021</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
        <span class="n">ax_sum</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">ax_pos_new</span><span class="p">)</span>

    <span class="c1"># move line plot to the left</span>
        <span class="n">ax_pos</span> <span class="o">=</span> <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">ax_pos_new</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax_pos</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">ax_pos</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
        <span class="n">ax_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">ax_pos_new</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax_psth</span> <span class="o">+</span> <span class="n">ax_psth_spks</span> <span class="o">+</span> <span class="n">ax_mtrx</span> <span class="o">+</span> <span class="n">ax_cb</span> <span class="o">+</span> <span class="n">ax_line</span> <span class="o">+</span> <span class="n">ax_hist</span> <span class="o">+</span> <span class="n">ax_bar</span> <span class="o">+</span> <span class="n">ax_sum</span></div>


<div class="viewcode-block" id="figure4"><a class="viewcode-back" href="../fig_ms.html#fig_ms.figure4">[docs]</a><span class="k">def</span> <span class="nf">figure4</span><span class="p">(</span><span class="n">spikes_jam_only</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">,</span> <span class="n">config_jam_only</span><span class="p">,</span>
            <span class="n">states_agg_jam_only</span><span class="p">,</span> <span class="n">info_agg_jam_only</span><span class="p">,</span> <span class="n">spiketimes_nexus</span><span class="p">,</span> <span class="n">traces_playback_aligned</span><span class="p">,</span>
            <span class="n">traces_nif</span><span class="p">,</span> <span class="n">spiketimes_nif</span><span class="p">,</span> <span class="n">suppr_win</span><span class="p">,</span> <span class="n">img_zf_listening</span><span class="p">,</span> <span class="n">img_bubble</span><span class="p">,</span> <span class="n">img_speaker</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">i_rows_call</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># call playback marker</span>
    <span class="n">i_cols_call</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i_rows_nif_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># traces of NIf cells</span>
    <span class="n">i_cols_nif_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_nif_trc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_nif_trc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_nif</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">]</span>  <span class="c1"># psths of NIf cells</span>
    <span class="n">i_cols_nif</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_nif</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_nif</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># circuit diagram</span>
    <span class="n">i_cols_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_crc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_cols_crc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_psth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># psths of Aud and Jam</span>
    <span class="n">i_cols_psth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">n_cols_psth</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_agg</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># aggregate trace and average of jam-only sim</span>
    <span class="n">i_cols_agg</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">n_rows_agg</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_agg</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">]</span>  <span class="c1"># playback-aligned subthreshold potentials of bursting PM</span>
    <span class="n">i_cols_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">n_rows_sub</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_sub</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_rows_default</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x_lim_psths</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">]</span>
    <span class="n">y_lim_psths_nif</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
    <span class="n">x_lim_agg</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">]</span>
    <span class="n">color_map_rec</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS_LIGHT</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>

    <span class="c1"># file, population &amp; trace indices</span>
    <span class="n">playback_onset_mod_jam_only</span> <span class="o">=</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">][</span><span class="s1">&#39;playback_start&#39;</span><span class="p">]</span>
    <span class="n">call_onset_ms_playback_aligned</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">t_baseline_psth_norm</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># for normalizing psths to baseline. Set to None to not normalize</span>
    <span class="n">id_rec_nrn_nxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span>
                      <span class="mi">161</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">169</span><span class="p">]</span>  <span class="c1"># final (putative interneurons with a significant activity peak w/in 100ms)</span>
    <span class="n">letter_pop_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_v}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_a}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">ax_crc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_nif</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_nif_spks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_nif_trc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_psth</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_agg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_sub</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_trc</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region call-marker axis ###################################################################################</span>
    <span class="n">y_lim_call</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax_call</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_call</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_call</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                               <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;:k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;:k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">sine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span> <span class="o">*</span> <span class="mi">55</span> <span class="o">-</span> <span class="mf">0.05</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="n">sine</span> <span class="o">*</span> <span class="n">gauss</span> <span class="o">/</span> <span class="mf">2.1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="c1"># embed zebra finch image</span>
    <span class="n">ax_call_bbox</span> <span class="o">=</span> <span class="n">ax_call</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
    <span class="n">ax_call_axes_ratio</span> <span class="o">=</span> <span class="n">ax_call_bbox</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">ax_call_bbox</span><span class="o">.</span><span class="n">height</span>
    <span class="n">ax_call_data_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_lim_call</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">inset_height</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">correction_factor</span> <span class="o">=</span> <span class="mf">0.888888</span>  <span class="c1"># apparrently axis gets stretched in finale saved image. this corrects for that</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_zf_listening</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                   <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">52</span> <span class="o">+</span> <span class="n">correction_factor</span> <span class="o">*</span> <span class="n">inset_height</span> <span class="o">*</span> <span class="n">ax_call_data_ratio</span> <span class="o">/</span> <span class="n">ax_call_axes_ratio</span><span class="p">,</span> <span class="o">-</span><span class="mi">52</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="n">inset_height</span><span class="p">))</span>
    <span class="n">ax_inset_img</span> <span class="o">=</span> <span class="n">ax_call</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">((</span><span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_call</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax_inset_img</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_bubble</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">),</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_inset_img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_inset_img</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">speaker_height</span> <span class="o">=</span> <span class="mf">0.7</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_speaker</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">130</span> <span class="o">+</span> <span class="n">correction_factor</span> <span class="o">*</span> <span class="n">speaker_height</span> <span class="o">*</span> <span class="n">ax_call_data_ratio</span> <span class="o">/</span> <span class="n">ax_call_axes_ratio</span><span class="p">,</span>
                           <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="n">speaker_height</span><span class="p">))</span>
    <span class="c1"># plot call marker</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;Call playback&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_call</span><span class="p">)</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># plot fake x-axis from call onset onwards</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span> <span class="p">(</span><span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">xt</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span>
        <span class="n">ax_call</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">xt</span><span class="p">,</span> <span class="n">xt</span><span class="p">),</span> <span class="p">(</span><span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim_call</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot circuit diagram ##############################################################################</span>
    <span class="n">x_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
    <span class="n">y_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
    <span class="n">conn_circ</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]]</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]</span>
    <span class="n">pop_gray</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">color_circ</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="n">color_conn</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="n">pop_gray</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]</span>
    <span class="n">ramp_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span>
    <span class="n">pulse_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">33</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">33</span><span class="p">)))</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ramp_current</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">pulse_current</span><span class="p">]]</span>
    <span class="n">rectangles</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># set axis limits and plot</span>
    <span class="n">x_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">y_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)):</span>
        <span class="n">ax_crc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_crc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_crc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_crc</span><span class="p">))</span>
        <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_type</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">letters</span><span class="o">=</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">currents</span><span class="o">=</span><span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_lim_crc</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="n">y_lim_crc</span><span class="p">,</span> <span class="n">region_label</span><span class="o">=</span><span class="s1">&#39;HVC&#39;</span><span class="p">,</span>
                        <span class="n">connection_colors</span><span class="o">=</span><span class="n">color_conn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">letter_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">region_rectangle_xywh</span><span class="o">=</span><span class="n">rectangles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># add text describing inputs next to circuit diagram</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;vocal-</span><span class="se">\n</span><span class="s1">related</span><span class="se">\n</span><span class="s1">input&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.95</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;auditory-</span><span class="se">\n</span><span class="s1">related</span><span class="se">\n</span><span class="s1">input&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot traces of NIf cells ################################################################</span>
    <span class="n">playback_onset_nif</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
    <span class="n">idx_nif_cells_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fs_nif_khz</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">idx_trace</span> <span class="o">=</span> <span class="mi">66</span>  <span class="c1"># 4, 69, 78</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx_nif</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_nif_cells_to_plot</span><span class="p">):</span>
        <span class="n">ax_nif_trc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                           <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_nif_trc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_nif_trc</span><span class="p">))</span>
        <span class="n">trace_nif_raw</span> <span class="o">=</span> <span class="n">traces_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">][</span><span class="n">idx_trace</span><span class="p">]</span>
        <span class="n">t_trc_nif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_nif_raw</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs_nif_khz</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_nif_raw</span><span class="p">))</span> <span class="o">-</span> <span class="n">playback_onset_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">]</span>
        <span class="n">trace_nif_cut</span> <span class="o">=</span> <span class="n">trace_nif_raw</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_trc_nif</span> <span class="o">&gt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_trc_nif</span> <span class="o">&lt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">t_trc_nif_cut</span> <span class="o">=</span> <span class="n">t_trc_nif</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_trc_nif</span> <span class="o">&gt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_trc_nif</span> <span class="o">&lt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_trc_nif_cut</span><span class="p">,</span> <span class="n">trace_nif_cut</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">ax_nif_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
    <span class="n">ax_nif_trc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;$\mathrm{NIf_</span><span class="si">{HVC}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_nif_trc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot psth of NIf cells ################################################################</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx_nif</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_nif_cells_to_plot</span><span class="p">):</span>
        <span class="n">ax_nif</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_nif</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_nif</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_nif</span><span class="p">))</span>
        <span class="c1"># plot spike raster</span>
        <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spiketimes_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">])</span>
        <span class="n">dot_color</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
            <span class="n">spikes_in_trial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spiketimes_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">][</span><span class="n">trial</span><span class="p">])</span> <span class="o">-</span> <span class="n">playback_onset_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">]</span>
            <span class="n">spikes_to_plot</span> <span class="o">=</span> <span class="n">spikes_in_trial</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">spikes_in_trial</span> <span class="o">&gt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                            <span class="n">spikes_in_trial</span> <span class="o">&lt;</span> <span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spikes_to_plot</span><span class="p">,</span> <span class="p">[</span><span class="n">trial</span> <span class="o">/</span> <span class="n">n_trials</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_lim_psths_nif</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_lim_psths_nif</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                            <span class="o">+</span> <span class="n">y_lim_psths_nif</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes_to_plot</span><span class="p">),</span>
                           <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">dot_color</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax_nif_spks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">])</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># no 0 tick</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">])</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Trials&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dot_color</span><span class="p">)</span>
        <span class="n">ax_nif_spks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="c1"># plot psth</span>
        <span class="n">t_nif</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_nif_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">],</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
        <span class="n">t_nif</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span> <span class="o">-</span> <span class="n">playback_onset_nif</span><span class="p">[</span><span class="n">idx_nif</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_nif</span><span class="p">]]</span>
        <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># playback offset</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_psths</span><span class="p">(</span><span class="n">t_nif</span><span class="p">,</span> <span class="n">psths_smooth</span><span class="o">=</span><span class="n">psth_nif_smooth</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
        <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_psths_nif</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_nif_cells_to_plot</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
            <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax_nif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax_nif</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike rate [Hz]&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_nif_cells_to_plot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ax_nif</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.13</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot psth of auditory population (that drives jamming interneurons) ####################</span>
    <span class="n">ax_psth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
    <span class="n">spiketimes_aud</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_spiketimes_from_monitor</span><span class="p">(</span><span class="n">spikes_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">t_aud_mod</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_aud_mod_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_aud</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
    <span class="n">t_aud_mod</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span> <span class="o">-</span> <span class="n">playback_onset_mod_jam_only</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_aud_mod</span><span class="p">]]</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_psths</span><span class="p">(</span><span class="n">t_aud_mod</span><span class="p">,</span> <span class="n">psths_smooth</span><span class="o">=</span><span class="n">psth_aud_mod_smooth</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span> <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">t_baseline</span><span class="o">=</span><span class="n">t_baseline_psth_norm</span><span class="p">,</span>
                      <span class="n">b_normalize_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike rate</span><span class="se">\n</span><span class="s1">rel. to baseline&#39;</span><span class="p">)</span>
    <span class="c1"># ax_psth[0].get_legend().remove()</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="c1"># inset axis with population circle</span>
    <span class="n">y_lim_psth</span> <span class="o">=</span> <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">ax_inset_pop</span> <span class="o">=</span> <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">((</span><span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">188</span><span class="p">,</span> <span class="n">y_lim_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">y_lim_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">),</span>
                                         <span class="n">transform</span><span class="o">=</span><span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
    <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_inset_pop</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">letters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">letter_size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax_inset_pop</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot psth of jamming interneurons with comparison to neuronexus recording ##########################</span>
    <span class="n">ax_psth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i_cols_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                    <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psth</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_default</span><span class="p">))</span>
    <span class="n">spiketimes_int</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_spiketimes_from_monitor</span><span class="p">(</span><span class="n">spikes_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">t_int_mod</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_int_mod_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_int</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
    <span class="n">t_int_rec_offset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">psth_int_rec_smooth</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">id_nrn</span> <span class="ow">in</span> <span class="n">id_rec_nrn_nxs</span><span class="p">:</span>
        <span class="c1"># find the index to spiketimes_nexus that points to the correct unit-playback combination</span>
        <span class="n">t_tmp</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">psth_tmp_smooth</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">get_psth</span><span class="p">(</span><span class="n">spiketimes_nexus</span><span class="p">[</span><span class="n">id_nrn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">200</span><span class="p">,</span>
                                                        <span class="c1"># note: adding 200 = quick fix (also trim_monitors_to_..?)</span>
                                                        <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sim_time&#39;</span><span class="p">])</span>
        <span class="n">t_int_rec_offset</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v</span> <span class="o">-</span> <span class="mi">200</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_tmp</span><span class="p">])</span>
        <span class="n">psth_int_rec_smooth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psth_tmp_smooth</span><span class="p">)</span>
    <span class="n">t_int_all</span> <span class="o">=</span> <span class="n">t_int_rec_offset</span> <span class="o">+</span> <span class="p">[[</span><span class="n">v</span> <span class="o">-</span> <span class="n">playback_onset_mod_jam_only</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t_int_mod</span><span class="p">]]</span>
    <span class="n">psth_int_smooth_all</span> <span class="o">=</span> <span class="n">psth_int_rec_smooth</span> <span class="o">+</span> <span class="p">[</span><span class="n">psth_int_mod_smooth</span><span class="p">]</span>
    <span class="n">colors_psth</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">7</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">psth_int_rec_smooth</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">7</span><span class="p">]]</span>
    <span class="n">labels_psth</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">id_rec_nrn_nxs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
    <span class="n">linewidth_psth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_int_rec_offset</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_psths</span><span class="p">(</span><span class="n">t_int_all</span><span class="p">,</span> <span class="n">psths_smooth</span><span class="o">=</span><span class="n">psth_int_smooth_all</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">colors</span><span class="o">=</span><span class="n">colors_psth</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels_psth</span><span class="p">,</span> <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth_psth</span><span class="p">,</span>
                      <span class="n">t_baseline</span><span class="o">=</span><span class="n">t_baseline_psth_norm</span><span class="p">,</span> <span class="n">b_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_normalize_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike rate</span><span class="se">\n</span><span class="s1">rel. to baseline&#39;</span><span class="p">)</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_psth</span><span class="p">)):</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_psth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_psths</span><span class="p">)</span>
    <span class="c1"># inset axis with population circle</span>
    <span class="n">y_lim_psth</span> <span class="o">=</span> <span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">ax_inset_pop</span> <span class="o">=</span> <span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">((</span><span class="n">x_lim_psths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">188</span><span class="p">,</span> <span class="n">y_lim_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">y_lim_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">),</span>
                                         <span class="n">transform</span><span class="o">=</span><span class="n">ax_psth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
    <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_inset_pop</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">letters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;$\mathbf</span><span class="si">{I_a}</span><span class="s1">$&#39;</span><span class="p">],</span> <span class="n">letter_size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax_inset_pop</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot aggregate traces of jam only sim ##############################################################</span>
    <span class="n">ax_agg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                   <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_agg</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_agg</span><span class="p">))</span>
    <span class="n">trim_time_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_lim_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">playback_onset_mod_jam_only</span><span class="p">,</span> <span class="n">x_lim_agg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">playback_onset_mod_jam_only</span><span class="p">)</span>
    <span class="n">states_agg_jam_only_trim</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">trim_monitors_to_time_span</span><span class="p">(</span><span class="n">trim_time_span</span><span class="p">,</span> <span class="n">statemons</span><span class="o">=</span><span class="n">states_agg_jam_only</span><span class="p">)</span>
    <span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_traces_mod</span><span class="p">(</span><span class="n">states_agg_jam_only_trim</span><span class="p">,</span> <span class="n">info_agg_jam_only</span><span class="p">,</span> <span class="n">t_offset_ms</span><span class="o">=</span><span class="n">playback_onset_mod_jam_only</span><span class="p">,</span>
                           <span class="n">b_spike_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_average_aggregate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">trace_color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">],</span> <span class="n">average_color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
    <span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_agg</span><span class="p">)</span>
    <span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region playback-aligned observed PM</span>
    <span class="n">ax_sub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                   <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_sub</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_sub</span><span class="p">))</span>
    <span class="n">samp_freq_khz</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">downsampling_factor</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">trace_playback_aligned_trim</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">trim_traces_to_time_span</span><span class="p">([</span><span class="n">call_onset_ms_playback_aligned</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span>
                                                                   <span class="n">call_onset_ms_playback_aligned</span> <span class="o">+</span> <span class="mi">125</span><span class="p">],</span>
                                                                  <span class="n">traces_playback_aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">samp_freq_khz</span><span class="p">)</span>
    <span class="n">trace_playback_aligned_trim_down</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">downsample_trace</span><span class="p">(</span><span class="n">trace_playback_aligned_trim</span><span class="p">,</span> <span class="n">downsampling_factor</span><span class="p">)</span>
    <span class="c1"># DE-MEAN</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_playback_aligned_trim_down</span><span class="p">)):</span>
        <span class="n">trace_playback_aligned_trim_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_playback_aligned_trim_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                                              <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trace_playback_aligned_trim_down</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_traces_rec</span><span class="p">(</span><span class="n">trace_playback_aligned_trim_down</span><span class="p">,</span> <span class="n">sampling_frequency_khz</span><span class="o">=</span><span class="n">samp_freq_khz</span> <span class="o">/</span> <span class="n">downsampling_factor</span><span class="p">,</span>
                           <span class="n">b_plot_raw_traces</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_plot_smoothed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_plot_average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_std_interval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">b_offset_by_average</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_n_in_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                           <span class="n">trace_color_smooth</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">],</span> <span class="n">average_color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">t_offset_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                           <span class="n">b_average_mean_2std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t_baseline_ms</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">h_l</span> <span class="o">=</span> <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
    <span class="n">h_l</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">h_l</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;average&#39;</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_agg</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="c1"># endregion</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_call</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span> <span class="o">/</span> <span class="n">n_cols_psth</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.83</span> <span class="o">/</span> <span class="n">n_cols_psth</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.83</span> <span class="o">/</span> <span class="n">n_cols_agg</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                       <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax_crc</span> <span class="o">+</span> <span class="p">[</span><span class="n">ax_call</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_psth</span> <span class="o">+</span> <span class="n">ax_agg</span> <span class="o">+</span> <span class="n">ax_sub</span> <span class="o">+</span> <span class="n">ax_nif</span> <span class="o">+</span> <span class="n">ax_nif_spks</span> <span class="o">+</span> <span class="n">ax_nif_trc</span></div>


<div class="viewcode-block" id="figure5"><a class="viewcode-back" href="../fig_ms.html#fig_ms.figure5">[docs]</a><span class="k">def</span> <span class="nf">figure5</span><span class="p">(</span><span class="n">states_jam_only</span><span class="p">,</span> <span class="n">spikes_jam_only</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">,</span> <span class="n">config_jam_only</span><span class="p">,</span>
            <span class="n">states_jam_ft</span><span class="p">,</span> <span class="n">spikes_jam_ft</span><span class="p">,</span> <span class="n">config_jam_ft</span><span class="p">,</span> <span class="n">info_jam_ft</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">,</span>
            <span class="n">call_onset_times</span><span class="p">,</span> <span class="n">suppr_win</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">i_rows_tpr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">]</span>  <span class="c1"># trace-per-run</span>
    <span class="n">i_cols_tpr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">n_cols_tpr</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_rows_tpr</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># circuit diagram</span>
    <span class="n">i_cols_crc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_crc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_cols_crc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_lat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">i_cols_lat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_lat</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_cols_lat</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>  <span class="c1"># example traces of bursting PM at different call onsets relative to playback</span>
    <span class="n">i_cols_trc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_trc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_trc</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_brst</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># burst onsets of all recorded bursting PMs</span>
    <span class="n">i_cols_brst</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">n_rows_brst</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_cols_brst</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">i_rows_ovrlp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># burst onsets of all recorded bursting PMs</span>
    <span class="n">i_cols_ovrlp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">n_rows_ovrlp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">n_cols_ovrlp</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_hist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>  <span class="c1"># histograms of call onsets (excerpt; sim, control, gabazine)</span>
    <span class="n">i_cols_hist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">n_rows_hist</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_hist</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">i_rows_hist_all</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># histograms of call onsets (full range; control, gabazine)</span>
    <span class="n">i_cols_hist_all</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">n_rows_hist_all</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">n_cols_hist_all</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">x_lim_tpr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">]</span>
    <span class="n">x_lim_traces</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">135</span><span class="p">]</span>
    <span class="n">y_lim_traces</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">color_map_rec</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS_LIGHT</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>

    <span class="c1"># file, population &amp; trace indices etc.</span>
    <span class="n">idx_nrn_oi_mod_abs_tpr</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_nrn_oi_relative&#39;</span><span class="p">],</span>
                                                             <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_pop_oi&#39;</span><span class="p">],</span>
                                                             <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
    <span class="n">playback_onset_mod_jam_only</span> <span class="o">=</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">][</span><span class="s1">&#39;playback_start&#39;</span><span class="p">]</span>
    <span class="n">rec_offset_ms_spiking</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]]</span>  <span class="c1"># realigned (last 100 before)</span>
    <span class="n">idx_mon_oi_mod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="n">idx_nrn_oi_mod_abs_trc</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="n">config_jam_ft</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_nrn_oi_relative&#39;</span><span class="p">],</span>
                                                             <span class="n">config_jam_ft</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_pop_oi&#39;</span><span class="p">],</span>
                                                             <span class="n">info_jam_ft</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
    <span class="n">idx_nrn_oi_mod_abs_tpr</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_nrn_oi_relative&#39;</span><span class="p">],</span>
                                                             <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_pop_oi&#39;</span><span class="p">],</span>
                                                             <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
    <span class="n">letter_pop_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_v}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_a}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span>
    <span class="n">artificial_spike_heights</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">xlims_burst</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">160</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_tpr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_crc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_trc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_brst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_ovrlp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_hist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_hist_all</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region plot trace per run jam only ########################################################################</span>
    <span class="c1"># add artificial spikes by increasing the potential value at spiketimes by a predefined amount</span>
    <span class="k">if</span> <span class="n">artificial_spike_heights</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes_jam_only</span><span class="p">)):</span>
            <span class="n">spiketimes_tpr</span> <span class="o">=</span> <span class="n">spikes_jam_only</span><span class="p">[</span><span class="n">run</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_jam_only</span><span class="p">[</span><span class="n">run</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_tpr</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span>
            <span class="k">for</span> <span class="n">spk</span> <span class="ow">in</span> <span class="n">spiketimes_tpr</span><span class="p">:</span>
                <span class="n">samp_spike</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spk</span> <span class="o">/</span> <span class="p">(</span><span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">)))</span>
                <span class="n">states_jam_only</span><span class="p">[</span><span class="n">run</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">idx_nrn_oi_mod_abs_tpr</span><span class="p">,</span> <span class="n">samp_spike</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">states_jam_only</span><span class="p">[</span><span class="n">run</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">idx_nrn_oi_mod_abs_tpr</span><span class="p">,</span> <span class="n">samp_spike</span><span class="p">]</span> <span class="o">+</span> <span class="n">artificial_spike_heights</span> <span class="o">*</span> <span class="n">b2</span><span class="o">.</span><span class="n">mV</span>
    <span class="c1"># trim monitors to time span in plot</span>
    <span class="n">trim_time_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_lim_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">playback_onset_mod_jam_only</span><span class="p">,</span> <span class="n">x_lim_tpr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">playback_onset_mod_jam_only</span><span class="p">)</span>
    <span class="n">states_jam_only_trim</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">trim_monitors_to_time_span</span><span class="p">(</span><span class="n">trim_time_span</span><span class="p">,</span> <span class="n">statemons</span><span class="o">=</span><span class="n">states_jam_only</span><span class="p">)</span>
    <span class="c1"># plot traces</span>
    <span class="n">ax_tpr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                   <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_tpr</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_tpr</span><span class="p">))</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_traces_per_run</span><span class="p">(</span><span class="n">states_jam_only_trim</span><span class="p">,</span> <span class="n">config_jam_only</span><span class="p">,</span> <span class="n">info_jam_only</span><span class="p">,</span>
                               <span class="n">t_offset_ms</span><span class="o">=</span><span class="n">playback_onset_mod_jam_only</span><span class="p">,</span>
                               <span class="n">b_spike_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">neuron_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">population_idx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b_maxmin_marker</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">b_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># format axis</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelright</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_tpr</span><span class="p">)</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">states_jam_only_trim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">idx_nrn_oi_mod_abs_tpr</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model premotor neuron&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># add colorbar to axis (multiply by 1000 to get pA instead of nA)</span>
    <span class="n">min_weight</span> <span class="o">=</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">max_weight</span> <span class="o">=</span> <span class="n">info_jam_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">h_cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">min_weight</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_weight</span><span class="p">),</span>
                                                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">drawedges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">])</span>
    <span class="n">h_cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Inhibitory weights [pA]&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot circuit diagram ##############################################################################</span>
    <span class="n">x_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
    <span class="n">y_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
    <span class="n">conn_circ</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]]</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]</span>
    <span class="n">color_circ</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                   <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="n">ramp_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span>
    <span class="n">pulse_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">33</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">33</span><span class="p">)))</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ramp_current</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">pulse_current</span><span class="p">]]</span>
    <span class="n">rectangles</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># set axis limits and plot</span>
    <span class="n">x_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)):</span>
        <span class="n">ax_crc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_crc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_crc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_crc</span><span class="p">))</span>
        <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_crc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_type</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">letters</span><span class="o">=</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">currents</span><span class="o">=</span><span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_lim_crc</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="n">y_lim_crc</span><span class="p">,</span> <span class="n">region_label</span><span class="o">=</span><span class="s1">&#39;HVC&#39;</span><span class="p">,</span>
                        <span class="n">letter_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">region_rectangle_xywh</span><span class="o">=</span><span class="n">rectangles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># add text describing inputs to circuit diagram</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;vocal-</span><span class="se">\n</span><span class="s1">related</span><span class="se">\n</span><span class="s1">input&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.95</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;auditory-</span><span class="se">\n</span><span class="s1">related</span><span class="se">\n</span><span class="s1">input&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot time of first spike (latency) versus time of jamming inhibition ###############################</span>
    <span class="n">ax_lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                   <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_lat</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_lat</span><span class="p">))</span>
    <span class="n">idx_t_start</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">idx_pop_fp</span> <span class="o">=</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]</span>
    <span class="n">lat_playback_to_t_start</span> <span class="o">=</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;input_current&#39;</span><span class="p">][</span><span class="s1">&#39;t_start&#39;</span><span class="p">][</span><span class="n">idx_pop_fp</span><span class="p">][</span><span class="n">idx_t_start</span><span class="p">]</span> \
                              <span class="o">-</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">][</span><span class="s1">&#39;playback_start&#39;</span><span class="p">]</span>
    <span class="n">t_first_spike_no_jam</span> <span class="o">=</span> <span class="n">spikes_jam_ft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEBUG: lat_playback_onset_to_t_start = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_playback_to_t_start</span><span class="p">))</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_t_first_spike_1d_jamming</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">,</span> <span class="n">config_jam_ft</span><span class="p">,</span> <span class="n">info_jam_ft</span><span class="p">,</span> <span class="n">idx_nrn_oi_mod_abs_tpr</span><span class="p">,</span>
                                         <span class="n">idx_pop_fp</span><span class="p">,</span> <span class="n">idx_t_start</span><span class="o">=</span><span class="n">idx_t_start</span><span class="p">,</span> <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                                         <span class="n">lat_playback_onset_to_t_start</span><span class="o">=</span><span class="n">lat_playback_to_t_start</span><span class="p">,</span>
                                         <span class="n">dot_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_mons_colored</span><span class="o">=</span><span class="n">idx_mon_oi_mod</span><span class="p">,</span>
                                         <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_mon_oi_mod</span><span class="p">))</span>
    <span class="c1"># t_const_event_marker=None)</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_traces</span><span class="p">)</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time of unperturbed burst onset</span><span class="se">\n</span><span class="s1">from playback onset [ms]&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Model burst</span><span class="se">\n</span><span class="s1">delay [ms]&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot example traces of bursting PM at different times relative to jamming interneuron, i.e. playback</span>
    <span class="n">traces_ft</span><span class="p">,</span> <span class="n">samp_freq_ft</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_jam_ft</span><span class="p">,</span> <span class="n">b_keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="p">[</span><span class="n">traces_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">],</span>
              <span class="n">traces_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">],</span>
              <span class="n">traces_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">]]</span>
    <span class="n">spiketimes_trc</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
        <span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
        <span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">]</span>
    <span class="n">samp_freqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">samp_freq_ft</span><span class="p">,</span> <span class="n">samp_freq_ft</span><span class="p">,</span> <span class="n">samp_freq_ft</span><span class="p">]</span>
    <span class="n">offset_ms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">info_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">idx_pop_fp</span><span class="p">][</span><span class="n">idx_t_start</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat_playback_to_t_start</span><span class="p">,</span>
        <span class="n">info_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">idx_pop_fp</span><span class="p">][</span><span class="n">idx_t_start</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat_playback_to_t_start</span><span class="p">,</span>
        <span class="n">info_jam_ft</span><span class="p">[</span><span class="n">idx_mon_oi_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">idx_pop_fp</span><span class="p">][</span><span class="n">idx_t_start</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat_playback_to_t_start</span><span class="p">]</span>
    <span class="c1"># plot traces</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traces</span><span class="p">):</span>
        <span class="n">ax_trc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_trc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_trc</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_trc</span><span class="p">))</span>
        <span class="c1"># add artificial spikes by increasing the potential value at spiketimes by a predefined amount</span>
        <span class="k">if</span> <span class="n">artificial_spike_heights</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">spk</span> <span class="ow">in</span> <span class="n">spiketimes_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">samp_spike</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spk</span> <span class="o">/</span> <span class="p">(</span><span class="n">info_jam_ft</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span><span class="p">)))</span>
                <span class="n">trc</span><span class="p">[</span><span class="n">samp_spike</span><span class="p">]</span> <span class="o">=</span> <span class="n">trc</span><span class="p">[</span><span class="n">samp_spike</span><span class="p">]</span> <span class="o">+</span> <span class="n">artificial_spike_heights</span>
        <span class="c1"># plot marker at the time the first spike would occur if there was no jamming inhibition</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t_first_spike_no_jam</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;unperturbed model burst&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># (0, (1, 1)) == densely dotted</span>
        <span class="c1"># plot trace</span>
        <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">trc</span><span class="o">.</span><span class="n">size</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">trc</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">offset_ms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">trc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;perturbed model trace&#39;</span><span class="p">)</span>
        <span class="c1"># format axis</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_traces</span><span class="p">)</span>
        <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_traces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_trc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot time of first spike of all trials per neuron ################################################</span>
    <span class="n">ax_brst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_brst</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_brst</span><span class="p">))</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">t_first_spike_nrn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_first_spike_avg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_first_spike_std</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spiketimes_rec_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">spikes_nrn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spiketimes_rec_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">t_first_spike_nrn</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">spikes_trial</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spikes_nrn</span><span class="p">):</span>
            <span class="c1"># NOTE: hardcoded criterion to exclude post-call spikes (100ms after call onset)</span>
            <span class="k">if</span> <span class="n">spikes_trial</span> <span class="ow">and</span> <span class="n">spikes_trial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">:</span>
                <span class="n">t_first_spike_nrn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikes_trial</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">t_first_spike_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t_first_spike_nrn</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
        <span class="n">t_first_spike_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">t_first_spike_nrn</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
    <span class="n">idx_nrn_sort_by_tfs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">t_first_spike_avg</span><span class="p">)</span>
    <span class="c1"># plot first spike of each trial in the same row for all trials of one neuron</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">nrn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_nrn_sort_by_tfs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">first_spike_trial</span> <span class="ow">in</span> <span class="n">t_first_spike_nrn</span><span class="p">[</span><span class="n">nrn</span><span class="p">]:</span>
            <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="p">(</span><span class="n">first_spike_trial</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> <span class="n">first_spike_trial</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">nrn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_nrn_sort_by_tfs</span><span class="p">):</span>
        <span class="c1"># plot the standard deviation</span>
        <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">t_first_spike_avg</span><span class="p">[</span><span class="n">nrn</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_first_spike_std</span><span class="p">[</span><span class="n">nrn</span><span class="p">]</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
                         <span class="n">t_first_spike_avg</span><span class="p">[</span><span class="n">nrn</span><span class="p">]</span> <span class="o">+</span> <span class="n">t_first_spike_std</span><span class="p">[</span><span class="n">nrn</span><span class="p">]</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]),</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># plot the average</span>
        <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_first_spike_avg</span><span class="p">[</span><span class="n">nrn</span><span class="p">]</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                        <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean, std of neuron &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_first_spike_avg</span><span class="p">[</span><span class="n">nrn</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_first_spike_std</span><span class="p">[</span><span class="n">nrn</span><span class="p">]))</span>
    <span class="c1"># add marker for estimated time window of burst onsets susceptible to inhibitory suppression</span>
    <span class="n">min_std_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">t_first_spike_avg</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_first_spike_std</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_first_spike_avg</span><span class="p">))])</span>
    <span class="n">burst_suppression_win</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_std_left</span> <span class="o">-</span> <span class="n">rec_offset_ms_spiking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">burst_suppression_win</span><span class="p">,</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_nrn_sort_by_tfs</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">burst_suppression_win</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_nrn_sort_by_tfs</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;est. window of</span><span class="se">\n</span><span class="s1">susceptibility&#39;</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_XS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims_burst</span><span class="p">)</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_nrn_sort_by_tfs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time of burst onsets from call onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed premotor neuron</span><span class="se">\n</span><span class="s1">(data from Benichov \&amp; Vallentin, 2020)&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot overlap of time window after playback in which inhibition can suppress PM bursts and estimated time</span>
    <span class="c1"># window before call production in which PM suppression could cancel a call.</span>
    <span class="c1"># calculate time window for each potential call onset (1ms steps) in which bursts would be succeptible to</span>
    <span class="c1"># suppression (i.e. the suppression window estimated from burst onsets of recorded PMs)</span>
    <span class="n">t_call_onset_sim_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">160</span><span class="p">)</span>
    <span class="n">x_lim_ovrlp</span> <span class="o">=</span> <span class="n">t_call_onset_sim_range</span>
    <span class="n">t_call_onset_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">burst_suppression_win_len</span> <span class="o">=</span> <span class="n">burst_suppression_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">burst_suppression_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">burst_windows_ms_lr</span> <span class="o">=</span> <span class="p">[</span><span class="n">t_call_onset_sim</span> <span class="o">+</span> <span class="n">burst_suppression_win</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_call_onset_sim</span> <span class="o">+</span> <span class="n">burst_suppression_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">t_overlap_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">))</span>
    <span class="n">ratio_overlap_with_suppr_win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i_call</span><span class="p">,</span> <span class="n">t_call</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">):</span>
        <span class="n">burst_win_l</span> <span class="o">=</span> <span class="n">burst_windows_ms_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_call</span><span class="p">]</span>
        <span class="n">burst_win_r</span> <span class="o">=</span> <span class="n">burst_windows_ms_lr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i_call</span><span class="p">]</span>
        <span class="n">b_burst_win_r_in_suppr_win</span> <span class="o">=</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">burst_win_r</span> <span class="o">&lt;</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">b_burst_win_l_in_suppr_win</span> <span class="o">=</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">burst_win_l</span> <span class="o">&lt;</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">b_burst_win_r_in_suppr_win</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">b_burst_win_l_in_suppr_win</span><span class="p">:</span>  <span class="c1"># late bursts suppressed</span>
            <span class="n">t_overlap_ms</span><span class="p">[</span><span class="n">i_call</span><span class="p">]</span> <span class="o">=</span> <span class="n">burst_win_r</span> <span class="o">-</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">b_burst_win_r_in_suppr_win</span> <span class="ow">and</span> <span class="n">b_burst_win_r_in_suppr_win</span><span class="p">:</span>  <span class="c1"># all bursts suppressed</span>
            <span class="n">t_overlap_ms</span><span class="p">[</span><span class="n">i_call</span><span class="p">]</span> <span class="o">=</span> <span class="n">burst_win_r</span> <span class="o">-</span> <span class="n">burst_win_l</span>
        <span class="k">elif</span> <span class="n">b_burst_win_l_in_suppr_win</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">b_burst_win_r_in_suppr_win</span><span class="p">:</span>  <span class="c1"># early bursts suppressed</span>
            <span class="n">t_overlap_ms</span><span class="p">[</span><span class="n">i_call</span><span class="p">]</span> <span class="o">=</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">burst_win_l</span>
        <span class="k">elif</span> <span class="n">burst_win_l</span> <span class="o">&lt;</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">burst_win_r</span> <span class="o">&gt;</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># middle bursts suppressed</span>
            <span class="n">t_overlap_ms</span><span class="p">[</span><span class="n">i_call</span><span class="p">]</span> <span class="o">=</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ratio_overlap_with_suppr_win</span><span class="p">[</span><span class="n">i_call</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_overlap_ms</span><span class="p">[</span><span class="n">i_call</span><span class="p">]</span> <span class="o">/</span> <span class="n">burst_suppression_win_len</span>
    <span class="c1"># plot examples of call onsets relative to playback and visualize the overlap of the two windows</span>
    <span class="n">ax_ovrlp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                     <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_ovrlp</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">suppr_win</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">suppr_win</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="c1"># index to t_call_onset_sim</span>
    <span class="n">i_example_onsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span> <span class="o">-</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">125</span> <span class="o">-</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i_ex</span><span class="p">,</span> <span class="n">idx_onset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_example_onsets</span><span class="p">):</span>
        <span class="c1"># plot window of susceptibility</span>
        <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">burst_windows_ms_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx_onset</span><span class="p">],</span> <span class="n">burst_windows_ms_lr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">idx_onset</span><span class="p">]),</span>
                         <span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">],</span> <span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">]),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># plot call onsets</span>
        <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">],</span> <span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">]),</span>
                         <span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_ovrlp</span><span class="p">)</span>
    <span class="c1"># ax_ovrlp[0].set_xlabel(&#39;Time from playback onset [ms]&#39;)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Time of call</span><span class="se">\n</span><span class="s1">onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">i_example_onsets</span><span class="p">])</span>
    <span class="c1"># plot percentage of estimated pre-call suppression window with</span>
    <span class="c1"># (estimated percentage of PM bursts, that would be suppressed for each call time re. to playback).</span>
    <span class="n">ax_ovrlp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i_cols_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                     <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_ovrlp</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_ex</span><span class="p">,</span> <span class="n">idx_onset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_example_onsets</span><span class="p">):</span>
        <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">[</span><span class="n">idx_onset</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_call_onset_sim</span><span class="p">,</span> <span class="n">ratio_overlap_with_suppr_win</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_ovrlp</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ratio_overlap_with_suppr_win</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">uppr.&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region histograms of simulated and recorded call onset times ########################################</span>
    <span class="c1"># create pseudorandomly, uniformly distributed call onsets w/o and w/ suppression</span>
    <span class="n">prng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
    <span class="n">call_onsets_rand</span> <span class="o">=</span> <span class="n">prng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">idx_closest_sim_onset</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">call_onsets_rand</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">t_call_onset_sim</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">call_onsets_rand</span><span class="p">))]</span>
    <span class="n">call_onsets_suppr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">call_onsets_rand</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prng</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ratio_overlap_with_suppr_win</span><span class="p">[</span><span class="n">idx_closest_sim_onset</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">):</span>
            <span class="n">call_onsets_suppr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="c1"># shift end of distribution of recorded calls to beginning (before 0)</span>
    <span class="n">i_calls_to_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">call_onset_times</span><span class="p">[</span><span class="s1">&#39;Control_1hz_call_onsets&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">call_onsets_control</span> <span class="o">=</span> <span class="n">call_onset_times</span><span class="p">[</span><span class="s1">&#39;Control_1hz_call_onsets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">call_onsets_control_shifted</span> <span class="o">=</span> <span class="n">call_onsets_control</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">call_onsets_control_shifted</span><span class="p">[</span><span class="n">i_calls_to_shift</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_onsets_control</span><span class="p">[</span><span class="n">i_calls_to_shift</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1000</span>
    <span class="n">i_calls_to_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">call_onset_times</span><span class="p">[</span><span class="s1">&#39;Gabazine_1hz_call_onsets&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">call_onsets_gabazine</span> <span class="o">=</span> <span class="n">call_onset_times</span><span class="p">[</span><span class="s1">&#39;Gabazine_1hz_call_onsets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">call_onsets_gabazine_shifted</span> <span class="o">=</span> <span class="n">call_onsets_gabazine</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">call_onsets_gabazine_shifted</span><span class="p">[</span><span class="n">i_calls_to_shift</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_onsets_gabazine</span><span class="p">[</span><span class="n">i_calls_to_shift</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1000</span>
    <span class="n">call_onsets_shifted</span> <span class="o">=</span> <span class="p">[</span><span class="n">call_onsets_suppr</span><span class="p">,</span> <span class="n">call_onsets_control_shifted</span><span class="p">,</span> <span class="n">call_onsets_gabazine_shifted</span><span class="p">]</span>
    <span class="n">clr</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">color_map_rec</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
    <span class="n">bins_n</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_rows_hist</span><span class="p">)):</span>
        <span class="n">ax_hist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_hist</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">i_cols_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span>
                                        <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_hist</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_hist</span><span class="p">))</span>
        <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">call_onsets_rand</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">],</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span>
                                      <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">call_onsets_shifted</span><span class="p">[</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span>
                                      <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="n">bins_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_ovrlp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;N simulated</span><span class="se">\n</span><span class="s1">call onsets&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;N observed</span><span class="se">\n</span><span class="s1">call onsets&#39;</span><span class="p">)</span>
        <span class="n">ax_hist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">max_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="k">for</span> <span class="n">bins</span> <span class="ow">in</span> <span class="n">bins_n</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]])</span>
    <span class="p">[</span><span class="n">ax_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_bin</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_hist</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_hist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ax_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">ax_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="n">max_bin</span> <span class="o">-</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;simulation</span><span class="se">\n</span><span class="s1">(no suppression)&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">])</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_bin</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;simulation&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="n">max_bin</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">max_bin</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;gabazine&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># add red borders to observed histograms</span>
    <span class="n">width_zoom</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_call_onset_sim_range</span><span class="p">])</span>
    <span class="n">zoom_area</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width_zoom</span><span class="p">,</span> <span class="n">max_bin</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">zoom_area</span><span class="p">)</span>
    <span class="n">zoom_area</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width_zoom</span><span class="p">,</span> <span class="n">max_bin</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">zoom_area</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region full histograms of recorded call onset times</span>
    <span class="n">ax_hist_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                        <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_hist_all</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_hist_all</span><span class="p">))</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">hist_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;gabazine&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">call_onsets_shifted</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">],</span>
                                      <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="mi">1000</span> <span class="o">+</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">hist_labels</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">call_onsets_shifted</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="mi">1000</span> <span class="o">+</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">bins_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;N observed</span><span class="se">\n</span><span class="s1">call onsets&#39;</span><span class="p">)</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">zoom_area</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">t_call_onset_sim_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width_zoom</span><span class="p">,</span> <span class="n">max_bin</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">zoom_area</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.07</span><span class="p">,</span> <span class="mf">1.04</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">/</span> <span class="n">n_cols_lat</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_trc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">/</span> <span class="n">n_cols_trc</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_brst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_cols_brst</span><span class="p">,</span> <span class="mf">1.04</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_cols_hist_all</span><span class="p">,</span> <span class="mf">1.055</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_ovrlp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">/</span> <span class="n">n_cols_ovrlp</span><span class="p">,</span> <span class="mf">1.09</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                         <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">/</span> <span class="n">n_cols_hist</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_tpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.25</span> <span class="o">/</span> <span class="n">n_cols_tpr</span><span class="p">,</span> <span class="mf">1.055</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax_brst</span> <span class="o">+</span> <span class="n">ax_ovrlp</span> <span class="o">+</span> <span class="n">ax_hist</span> <span class="o">+</span> <span class="n">ax_hist_all</span> <span class="o">+</span> <span class="n">ax_tpr</span> <span class="o">+</span> <span class="n">ax_lat</span> <span class="o">+</span> <span class="n">ax_trc</span> <span class="o">+</span> <span class="p">[</span><span class="n">h_cb</span><span class="o">.</span><span class="n">ax</span><span class="p">]</span></div>


<div class="viewcode-block" id="fig_s_sensitivity"><a class="viewcode-back" href="../fig_ms.html#fig_ms.fig_s_sensitivity">[docs]</a><span class="k">def</span> <span class="nf">fig_s_sensitivity</span><span class="p">(</span><span class="n">config_name_sens_lo</span><span class="p">,</span> <span class="n">run_id_sens</span><span class="p">,</span> <span class="n">idx_marked_sim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b_mark_weight_sims</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">run_id_sens</span><span class="p">:</span>
        <span class="n">b_run_id_in_filename</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b_run_id_in_filename</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">routine</span><span class="o">.</span><span class="n">sensitivity_analysis</span><span class="p">(</span><span class="n">config_name_sens_lo</span><span class="p">,</span> <span class="n">run_id_sens</span><span class="p">,</span> <span class="n">b_show_figures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">b_run_id_in_filename</span><span class="o">=</span><span class="n">b_run_id_in_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">idx_marked_sim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
            <span class="c1"># color mark relevant simulations</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">idx_marked_sim</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b_mark_weight_sims</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">139</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">34</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="fig_s_current"><a class="viewcode-back" href="../fig_ms.html#fig_ms.fig_s_current">[docs]</a><span class="k">def</span> <span class="nf">fig_s_current</span><span class="p">(</span><span class="n">states_curr</span><span class="p">,</span> <span class="n">info_curr</span><span class="p">,</span> <span class="n">config_curr</span><span class="p">):</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">})</span>
    <span class="n">n_pops</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">info_curr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
    <span class="n">n_gridcols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_pops</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">n_gridrows</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_gridrows</span><span class="p">,</span> <span class="n">n_gridcols</span><span class="p">)</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">],</span> <span class="n">i_colors</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

    <span class="c1"># loop through populations</span>
    <span class="n">marker_linestyle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pops</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_gridrows</span><span class="p">,</span> <span class="n">n_gridcols</span><span class="p">),</span> <span class="p">(</span><span class="n">pop</span> <span class="o">%</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pop</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span>
                                     <span class="n">colspan</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># plot a vertical line to mark call/playback onset</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">marker_linestyle</span><span class="p">[</span><span class="n">pop</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># plot input current</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">states_curr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span> <span class="o">-</span> <span class="n">config_curr</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">][</span><span class="s1">&#39;playback_start&#39;</span><span class="p">],</span>
                       <span class="n">states_curr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Ie</span><span class="p">[</span><span class="n">pop</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">pA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="n">pop</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># other settings</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathbf</span><span class="si">{I_e}</span><span class="s1">$ [pA]&#39;</span><span class="p">)</span>
        <span class="c1"># axes[pop].set_ylim(abs_min_trc, abs_max_trc)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from call onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>

    <span class="c1"># share x axis (time) among all  plots</span>
    <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_shared_x_axes</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pops</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_shared_y_axes</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>


<div class="viewcode-block" id="fig_s_psp"><a class="viewcode-back" href="../fig_ms.html#fig_ms.fig_s_psp">[docs]</a><span class="k">def</span> <span class="nf">fig_s_psp</span><span class="p">(</span><span class="n">states_psp</span><span class="p">,</span> <span class="n">config_psp</span><span class="p">,</span> <span class="n">info_psp</span><span class="p">):</span>
    <span class="n">fig_psp</span><span class="p">,</span> <span class="n">ax_psp</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_psp_psc</span><span class="p">(</span><span class="n">states_psp</span><span class="p">,</span> <span class="n">config_psp</span><span class="p">,</span> <span class="n">info_psp</span><span class="p">,</span> <span class="n">i_colors</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_psp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_psp</span><span class="p">,</span> <span class="n">ax_psp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="fig_s_prespike_ramp"><a class="viewcode-back" href="../fig_ms.html#fig_ms.fig_s_prespike_ramp">[docs]</a><span class="k">def</span> <span class="nf">fig_s_prespike_ramp</span><span class="p">(</span><span class="n">states_ag0</span><span class="p">,</span> <span class="n">spikes_ag0</span><span class="p">,</span> <span class="n">info_ag0</span><span class="p">,</span>
                        <span class="n">states_ag1</span><span class="p">,</span> <span class="n">spikes_ag1</span><span class="p">,</span> <span class="n">info_ag1</span><span class="p">,</span> <span class="n">states_ag2</span><span class="p">,</span> <span class="n">spikes_ag2</span><span class="p">,</span> <span class="n">info_ag2</span><span class="p">,</span>
                        <span class="n">states_ag1_lowin</span><span class="p">,</span> <span class="n">spikes_ag1_lowin</span><span class="p">,</span> <span class="n">info_ag1_lowin</span><span class="p">,</span>
                        <span class="n">states_ag2_lowin</span><span class="p">,</span> <span class="n">spikes_ag2_lowin</span><span class="p">,</span> <span class="n">info_ag2_lowin</span><span class="p">,</span>
                        <span class="n">traces_spiking</span><span class="p">,</span> <span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">traces_gabazine</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">i_rows_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">i_cols_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">n_rows_psa</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_psa</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">i_rows_dot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">i_cols_dot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="n">n_rows_dot</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_cols_dot</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">i_rows_crc_big</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">i_cols_crc_big</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_crc_big</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_cols_crc_big</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># file, population &amp; trace indices</span>
    <span class="n">samp_freq_rec</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">letter_pop_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;$\mathbf</span><span class="si">{I_v}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="n">dur_prespike</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">t1_prespike</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># this minus dur_prespike in the plot; same for t2</span>
    <span class="n">t2_prespike</span> <span class="o">=</span> <span class="n">dur_prespike</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="n">color_map_rec</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS_LIGHT</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>
    <span class="n">color_map_mod</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">ax_crc_big</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_psa</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_dot</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region plot big circuit diagrams on top ###################################################################</span>
    <span class="c1"># alternative diagram with no-inhibition model PMs receiving motor-related input as well</span>
    <span class="n">x_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
    <span class="n">y_circuit</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]]</span>
    <span class="n">conn_circ</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]]</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]</span>
    <span class="n">conn_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">]]</span>
    <span class="n">color_circ</span> <span class="o">=</span> <span class="p">[[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color_map_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="p">[[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
               <span class="p">[</span><span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">letter_pop_mod</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
    <span class="n">ramp_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ramp_current</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="c1"># set axis limits and plot</span>
    <span class="n">x_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.7</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">y_lim_crc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">y_circuit</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="n">text_mod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;No inhibition&#39;</span><span class="p">,</span> <span class="s1">&#39;Tonic inhibition&#39;</span><span class="p">,</span> <span class="s1">&#39;Feed-forward</span><span class="se">\n</span><span class="s1">inhibition&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_circuit</span><span class="p">)):</span>
        <span class="n">ax_crc_big</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i_cols_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                           <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_crc_big</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_crc_big</span><span class="p">))</span>
        <span class="n">circuit_diagram</span><span class="p">(</span><span class="n">ax_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_circuit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_circ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conn_type</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">letters</span><span class="o">=</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">currents</span><span class="o">=</span><span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_lim_crc</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="n">y_lim_crc</span><span class="p">,</span>
                        <span class="n">letter_size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">,</span> <span class="n">connection_colors</span><span class="o">=</span><span class="n">conn_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax_crc_big</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.555</span><span class="p">,</span> <span class="n">text_mod</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_M</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region plot prespike averages of recorded premotor neurons and model neurons (100 run random current avg.)</span>
    <span class="n">traces_rec_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">traces_spiking</span><span class="p">,</span> <span class="n">traces_gabazine</span><span class="p">]</span>
    <span class="n">spiketimes_rec_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">spiketimes_spiking</span><span class="p">,</span> <span class="n">spiketimes_gabazine</span><span class="p">]</span>
    <span class="n">states_mod</span> <span class="o">=</span> <span class="p">[</span><span class="n">states_ag0</span><span class="p">,</span> <span class="n">states_ag0</span><span class="p">,</span> <span class="n">states_ag2</span><span class="p">,</span> <span class="n">states_ag2_lowin</span><span class="p">,</span> <span class="n">states_ag1</span><span class="p">,</span> <span class="n">states_ag1_lowin</span><span class="p">]</span>
    <span class="n">spikes_mod</span> <span class="o">=</span> <span class="p">[</span><span class="n">spikes_ag0</span><span class="p">,</span> <span class="n">spikes_ag0</span><span class="p">,</span> <span class="n">spikes_ag2</span><span class="p">,</span> <span class="n">spikes_ag2_lowin</span><span class="p">,</span> <span class="n">spikes_ag1</span><span class="p">,</span> <span class="n">spikes_ag1_lowin</span><span class="p">]</span>
    <span class="n">info_mod</span> <span class="o">=</span> <span class="p">[</span><span class="n">info_ag0</span><span class="p">,</span> <span class="n">info_ag0</span><span class="p">,</span> <span class="n">info_ag2</span><span class="p">,</span> <span class="n">info_ag2_lowin</span><span class="p">,</span> <span class="n">info_ag1</span><span class="p">,</span> <span class="n">info_ag1_lowin</span><span class="p">]</span>
    <span class="n">i_traces_rec_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">i_spiketimes_rec_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">i_colors_psa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">i_pops_ag</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">v_t1</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># voltages of prespike average at timepoint 1 (see above t1_prespike)</span>
    <span class="n">v_t2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_cols_psa</span><span class="p">)):</span>
        <span class="n">ax_psa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_psa</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">i_cols_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_psa</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_psa</span><span class="p">))</span>
        <span class="n">v_t1</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">v_t2</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="c1"># plot marker for t2, as well as labels for the timepoints at which Vm difference is measured for ax_dot (t1,t2)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t2_prespike</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t1_prespike</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">)</span>
            <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t2_prespike</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">FONTSIZE_S</span><span class="p">)</span>
        <span class="c1"># get and plot recorded traces preceding and aligned to first spike</span>
        <span class="n">smoothed_prespike_averages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_traces_in_prespike_avg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traces_rec_all</span><span class="p">[</span><span class="n">i_traces_rec_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]])):</span>
            <span class="n">smoothed_timeseries_average</span><span class="p">,</span> <span class="n">smoothed_timeseries_all</span><span class="p">,</span> <span class="n">n_traces_included</span> <span class="o">=</span> \
                <span class="n">p_analysis</span><span class="o">.</span><span class="n">prespike_trace_average</span><span class="p">(</span><span class="n">traces_rec_all</span><span class="p">[</span><span class="n">i_traces_rec_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span>
                                                  <span class="n">spiketimes_rec_all</span><span class="p">[</span><span class="n">i_spiketimes_rec_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">duration</span><span class="o">=</span><span class="n">dur_prespike</span><span class="p">)</span>
            <span class="n">v_t1</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_average</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">t1_prespike</span> <span class="o">*</span> <span class="n">samp_freq_rec</span><span class="p">))])</span>
            <span class="n">v_t2</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_average</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">t2_prespike</span> <span class="o">*</span> <span class="n">samp_freq_rec</span><span class="p">))])</span>
            <span class="n">smoothed_prespike_averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_average</span><span class="p">)</span>
            <span class="n">n_traces_in_prespike_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_traces_included</span><span class="p">)</span>
            <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freq_rec</span>
            <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">smoothed_timeseries_average</span><span class="o">.</span><span class="n">size</span>
            <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">smoothed_timeseries_average</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">h_rec</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">smoothed_timeseries_average</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># get and plot prespike average of aggregate model data</span>
        <span class="n">spiketimes_ms_ag</span> <span class="o">=</span> <span class="p">[</span><span class="n">p_util</span><span class="o">.</span><span class="n">get_spiketimes_from_monitor</span><span class="p">(</span><span class="n">spikes_mod</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">m</span><span class="p">],</span> <span class="n">info_mod</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">m</span><span class="p">],</span> <span class="n">i_pops_ag</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes_mod</span><span class="p">[</span><span class="n">p</span><span class="p">]))]</span>
        <span class="n">traces_ag</span><span class="p">,</span> <span class="n">samp_freq_ag</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_traces_from_monitors</span><span class="p">(</span><span class="n">states_mod</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="c1"># get prespike trace average</span>
        <span class="n">smoothed_timeseries_ag_avg</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">n_traces_included</span> <span class="o">=</span> <span class="n">p_analysis</span><span class="o">.</span><span class="n">prespike_trace_average</span><span class="p">(</span>
            <span class="p">[</span><span class="n">traces_ag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">mV</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traces_ag</span><span class="p">))],</span>
            <span class="p">[</span><span class="n">spiketimes_ms_ag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spiketimes_ms_ag</span><span class="p">))],</span> <span class="n">duration</span><span class="o">=</span><span class="n">dur_prespike</span><span class="p">,</span>
            <span class="n">b_spiketime_is_onset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sampling_frequency_khz</span><span class="o">=</span><span class="n">samp_freq_ag</span><span class="p">,</span> <span class="n">b_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">v_t1</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_ag_avg</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">t1_prespike</span> <span class="o">*</span> <span class="n">samp_freq_ag</span><span class="p">))])</span>
        <span class="n">v_t2</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_ag_avg</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">t2_prespike</span> <span class="o">*</span> <span class="n">samp_freq_ag</span><span class="p">))])</span>
        <span class="n">smoothed_prespike_averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_timeseries_ag_avg</span><span class="p">)</span>
        <span class="n">n_traces_in_prespike_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_traces_included</span><span class="p">)</span>
        <span class="c1"># plot aggregate model prespike average</span>
        <span class="n">dur_sample</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">samp_freq_ag</span>
        <span class="n">dur_trace</span> <span class="o">=</span> <span class="n">dur_sample</span> <span class="o">*</span> <span class="n">smoothed_timeseries_ag_avg</span><span class="o">.</span><span class="n">size</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur_trace</span><span class="p">,</span> <span class="n">smoothed_timeseries_ag_avg</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">h_mod</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">dur_prespike</span><span class="p">,</span> <span class="n">smoothed_timeseries_ag_avg</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">color_map_mod</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y_lim_psa</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">(</span><span class="n">h_rec</span><span class="p">,</span> <span class="n">h_mod</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">dur_prespike</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim_psa</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from first spike [ms]&#39;</span><span class="p">)</span>
        <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
        <span class="c1"># for every second plot remove y axis labels</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax_psa</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region dot plots of difference in potential at two time points prior to first spike (i.e. ramp &quot;magnitude&quot;)</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_cols_dot</span><span class="p">)):</span>
        <span class="n">ax_dot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_dot</span><span class="p">[</span><span class="n">g</span><span class="p">],</span> <span class="n">i_cols_dot</span><span class="p">[</span><span class="n">g</span><span class="p">]),</span>
                                       <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_dot</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_dot</span><span class="p">))</span>
        <span class="n">v_diff_control</span> <span class="o">=</span> <span class="p">[</span><span class="n">v_t2</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_t1</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_t1</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]))]</span>
        <span class="n">v_diff_gabazine</span> <span class="o">=</span> <span class="p">[</span><span class="n">v_t2</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_t1</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_t1</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))]</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="p">[[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]]]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_diff_control</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]]]]</span>\
            <span class="o">+</span> <span class="p">[[</span><span class="n">color_map_rec</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_diff_gabazine</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> \
            <span class="o">+</span> <span class="p">[</span><span class="n">color_map_mod</span><span class="p">[</span><span class="n">i_colors_psa</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]]]</span>
        <span class="n">mrkr</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_diff_control</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_diff_gabazine</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">8</span><span class="p">]]</span>
        <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_diff_control: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v_diff_control</span><span class="p">]</span>
        <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_diff_gabazine: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v_diff_gabazine</span><span class="p">]</span>
        <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;clr: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clr</span><span class="p">]</span>
        <span class="n">ax_dot</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_plot</span><span class="o">.</span><span class="n">dot_plot</span><span class="p">([</span><span class="n">v_diff_control</span><span class="p">,</span> <span class="n">v_diff_gabazine</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;gabazine&#39;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">value_colors</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span>
                        <span class="n">b_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jitter_thresh</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">jitter_offset</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">marker_size</span><span class="o">=</span><span class="n">mrkr</span><span class="p">,</span>
                        <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_dot</span><span class="p">[</span><span class="n">g</span><span class="p">])</span>
        <span class="n">ax_dot</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">38</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">ax_dot</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ difference (t2 - t1) [mV]&#39;</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># add sub-figure labels</span>
    <span class="n">ax_crc_big</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_crc_big</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_crc_big</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_psa</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_dot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_dot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>
    <span class="n">ax_dot</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">FONTSIZE_XL</span><span class="p">)</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax_psa</span> <span class="o">+</span> <span class="n">ax_dot</span></div>


<div class="viewcode-block" id="fig_s_depolarized"><a class="viewcode-back" href="../fig_ms.html#fig_ms.fig_s_depolarized">[docs]</a><span class="k">def</span> <span class="nf">fig_s_depolarized</span><span class="p">(</span><span class="n">traces_playback_aligned</span><span class="p">):</span>
    <span class="c1"># figure parameters</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">i_rows_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># playback-aligned subthreshold potentials of bursting PM</span>
    <span class="n">i_cols_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_rows_sub</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_cols_sub</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">x_lim_agg</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">165</span><span class="p">]</span>
    <span class="n">color_map_rec</span> <span class="o">=</span> <span class="n">p_plot</span><span class="o">.</span><span class="n">get_color_list</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_map_in</span><span class="o">=</span><span class="p">[</span><span class="n">C_COLORS_LIGHT</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">COL_SEQ</span><span class="p">])</span>

    <span class="c1"># file, population &amp; trace indices</span>
    <span class="n">call_onset_ms_playback_aligned</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="c1"># set up figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mf">0.888</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>
    <span class="n">ax_sub</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># region playback-aligned observed PM</span>
    <span class="n">ax_sub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="p">(</span><span class="n">i_rows_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i_cols_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                   <span class="n">colspan</span><span class="o">=</span><span class="n">n_cols_sub</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">n_rows_sub</span><span class="p">))</span>
    <span class="n">samp_freq_khz</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">downsampling_factor</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">trace_playback_aligned_trim</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">trim_traces_to_time_span</span><span class="p">([</span><span class="n">call_onset_ms_playback_aligned</span> <span class="o">+</span> <span class="n">x_lim_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                   <span class="n">call_onset_ms_playback_aligned</span> <span class="o">+</span> <span class="n">x_lim_agg</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                                                  <span class="n">traces_playback_aligned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">samp_freq_khz</span><span class="p">)</span>
    <span class="n">trace_playback_aligned_trim_down</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">downsample_trace</span><span class="p">(</span><span class="n">trace_playback_aligned_trim</span><span class="p">,</span> <span class="n">downsampling_factor</span><span class="p">)</span>
    <span class="c1"># DE-MEAN</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_playback_aligned_trim_down</span><span class="p">)):</span>
        <span class="n">trace_playback_aligned_trim_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_playback_aligned_trim_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">trace_playback_aligned_trim_down</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">p_plot</span><span class="o">.</span><span class="n">plot_traces_rec</span><span class="p">(</span><span class="n">trace_playback_aligned_trim_down</span><span class="p">,</span> <span class="n">sampling_frequency_khz</span><span class="o">=</span><span class="n">samp_freq_khz</span> <span class="o">/</span> <span class="n">downsampling_factor</span><span class="p">,</span>
                           <span class="n">b_plot_raw_traces</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_plot_smoothed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_plot_average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_std_interval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">b_offset_by_average</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">b_n_in_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">t_const_event_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">marker_linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                           <span class="n">trace_color_smooth</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">],</span> <span class="n">average_color</span><span class="o">=</span><span class="n">color_map_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">t_offset_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                           <span class="n">b_average_mean_2std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t_baseline_ms</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">h_ax</span><span class="o">=</span><span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>  <span class="c1"># playback offset</span>
    <span class="n">h_l</span> <span class="o">=</span> <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">h_l</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">h_l</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;average&#39;</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time from playback onset [ms]&#39;</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{V_m}</span><span class="s1">$ [mV]&#39;</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim_agg</span><span class="p">)</span>
    <span class="n">ax_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># endregion</span>

    <span class="c1"># adjust subplot margins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax_sub</span></div>


<div class="viewcode-block" id="circuit_diagram"><a class="viewcode-back" href="../fig_ms.html#fig_ms.circuit_diagram">[docs]</a><span class="k">def</span> <span class="nf">circuit_diagram</span><span class="p">(</span><span class="n">h_ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">connection_type</span><span class="p">,</span> <span class="n">connection_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">letters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">currents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">letter_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">region_rectangle_xywh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">region_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth_circle</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draw a circuit diagram in axis h_ax, consisting of populations represented as colored circles, whose positions</span>
<span class="sd">    and colors are given by x, y and colors (index to those is population id). Connections between populations</span>
<span class="sd">    are drawn according to connectivity: one tuple of pre and post population id per connection. Arrowheads for each</span>
<span class="sd">    (triangle/circle) are given by connection_type (-1/1 corresponds to excitatory/inhibitory).</span>

<span class="sd">    :param h_ax: axis handle</span>
<span class="sd">    :param x: list of x-axis positions for the populations. one value per population.</span>
<span class="sd">    :param y: list of y-axis positions for the populations. one value per population.</span>
<span class="sd">    :param colors: list of color values for the population circles . one value (e.g. RGB tuple) per population.</span>
<span class="sd">        where the value is None, the corresponding array in currents will be plotted instead of a population circle.</span>
<span class="sd">    :param connectivity: list of 2-element tuples givin id of pre- and post-population (corresponding to x/y indices)</span>
<span class="sd">    :param connection_type: list of negative (inhibitory) or positive (excitatory) floats with same length as</span>
<span class="sd">        connectivity (n connections). Absolute size of the floats or ints determins line width of the connecting lines.</span>
<span class="sd">    :param connection_colors: list of color values for the connecting lines with same length as connectivity.</span>
<span class="sd">    :param letters: optional list of strings (letters/symbols) or Nones, one per population, to be printed in the circle</span>
<span class="sd">    :param letter_size: font size of the letters</span>
<span class="sd">    :param currents: optional list of arrays of input currents. list length should be number of populations. should be</span>
<span class="sd">        None except where a missing colors value (i.e. None) indicates that a current should be plotted instead of a pop</span>
<span class="sd">        circle. minimum should be 0 for proper scaling.</span>
<span class="sd">    :param x_lim: x-axis limits. if None (default), adjust automatically</span>
<span class="sd">    :param y_lim: y-axis limits. if None (default), adjust automatically</span>
<span class="sd">    :param region_rectangle_xywh: list of x, y, width, height values for a gray rectangle indicating a brain region.</span>
<span class="sd">        x and y are the positions of the bottom left population (circle) in the region. width/height is the number of</span>
<span class="sd">        populations in x/y direction included in the region, minus one (i.e. single population at 1, 1: [1, 1, 0, 0])</span>
<span class="sd">    :param region_label: string label for region, to be plotted below rectangle</span>
<span class="sd">    :param linestyle: list of strings of linestyles for the connecting lines (e.g. &#39;--&#39;, &#39;:&#39;). default: &#39;-&#39;</span>
<span class="sd">    :param linewidth_circle: float linewidth used for all circles (neurons/populations). Default = 2. Current: - 0.5</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">crc_radius</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># radius of circles representing neuron populations</span>
    <span class="n">inh_conn_radius</span> <span class="o">=</span> <span class="mf">0.08</span>  <span class="c1"># radius of circles representing inhibitory connections</span>
    <span class="n">arrow_headsize</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># size of triangles representing excitatory connections</span>

    <span class="k">if</span> <span class="n">connection_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">connection_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linestyle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span>

    <span class="c1"># plot rectangle indicating brain region</span>
    <span class="k">if</span> <span class="n">region_rectangle_xywh</span><span class="p">:</span>
        <span class="n">rect_x</span> <span class="o">=</span> <span class="n">region_rectangle_xywh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span>
        <span class="n">rect_y</span> <span class="o">=</span> <span class="n">region_rectangle_xywh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span>
        <span class="n">rect_w</span> <span class="o">=</span> <span class="n">region_rectangle_xywh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.4</span>
        <span class="n">rect_h</span> <span class="o">=</span> <span class="n">region_rectangle_xywh</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.4</span>
        <span class="k">if</span> <span class="n">region_label</span><span class="p">:</span>
            <span class="n">rect_y</span> <span class="o">-=</span> <span class="mf">0.3</span>
            <span class="n">rect_h</span> <span class="o">+=</span> <span class="mf">0.3</span>
            <span class="n">h_ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rect_x</span> <span class="o">+</span> <span class="n">rect_w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rect_y</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">region_label</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">letter_size</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="n">rect_x</span><span class="p">,</span> <span class="n">rect_y</span><span class="p">),</span> <span class="n">rect_w</span><span class="p">,</span> <span class="n">rect_h</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">],</span>
                                                <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">h_ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

    <span class="c1"># plot a line between circles for each connection &amp; triangles/circles representing endpoints of exc/inh connections</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectivity</span><span class="p">):</span>
        <span class="n">h_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">color</span><span class="o">=</span><span class="n">connection_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">linewidth</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">connection_type</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># plot arrows for excitatory synapses</span>
        <span class="k">if</span> <span class="n">connection_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># pre_y - post_y, pre_x - post_x</span>
            <span class="n">arrow_len</span> <span class="o">=</span> <span class="p">[</span><span class="n">crc_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">arrow_len</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">arrow_len</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">connection_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                      <span class="n">edgecolor</span><span class="o">=</span><span class="n">connection_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">head_width</span><span class="o">=</span><span class="n">arrow_headsize</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="n">arrow_headsize</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># plot small circles for inhibitory synapses</span>
        <span class="k">elif</span> <span class="n">connection_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># pre_y - post_y, pre_x - post_x</span>
            <span class="n">crc_dist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">crc_radius</span> <span class="o">+</span> <span class="n">inh_conn_radius</span> <span class="o">+</span> <span class="mf">0.035</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">crc_radius</span> <span class="o">+</span> <span class="n">inh_conn_radius</span> <span class="o">+</span> <span class="mf">0.035</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)]</span>
            <span class="n">circle_in_syn</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">crc_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">crc_dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">inh_conn_radius</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                       <span class="n">edgecolor</span><span class="o">=</span><span class="n">connection_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">connection_type</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">circle_in_syn</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">h_ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle_in_syn</span><span class="p">)</span>

    <span class="c1"># plot circles representing neuron populations or input currents</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">currents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">currents</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">circle_tmp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">h_ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle_tmp</span><span class="p">)</span>  <span class="c1"># white circle for background</span>
            <span class="n">h_current</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">currents</span><span class="p">[</span><span class="n">p</span><span class="p">])),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currents</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">currents</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="o">*</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span>
                                      <span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                                  <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
            <span class="n">h_current</span><span class="o">.</span><span class="n">set_solid_capstyle</span><span class="p">(</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
            <span class="n">circle_tmp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span> <span class="n">crc_radius</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                                    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth_circle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">h_ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle_tmp</span><span class="p">)</span>  <span class="c1"># dashed, grey circle surrounding current</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">circle_tmp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span> <span class="n">crc_radius</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth_circle</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">h_ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle_tmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">letters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">letters</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
                <span class="n">h_ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">letters</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">letter_size</span><span class="p">,</span>
                          <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="c1"># set net axis aspect equal (i.e. resizing figure will not affect shape of axis) and other formatting</span>
    <span class="n">h_ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">h_ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_lim</span><span class="p">:</span>
        <span class="n">h_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">y_lim</span><span class="p">:</span>
        <span class="n">h_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span></div>


<div class="viewcode-block" id="load_model_data"><a class="viewcode-back" href="../fig_ms.html#fig_ms.load_model_data">[docs]</a><span class="k">def</span> <span class="nf">load_model_data</span><span class="p">(</span><span class="n">model_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get simulation results from .pkl file.</span>

<span class="sd">    :param model_name: model name (filename of output pickle file without &quot;.pkl&quot; ending)</span>
<span class="sd">    :type model_name: str</span>
<span class="sd">    :return: output variables (monitors, connectivity, config, info) as returned by p_io.load_monitors()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filename_pkl</span> <span class="o">=</span> <span class="n">p_io</span><span class="o">.</span><span class="n">BASE_PATH_OUTPUT</span> <span class="o">+</span> <span class="s1">&#39;out&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
    <span class="k">return</span> <span class="n">p_io</span><span class="o">.</span><span class="n">load_monitors</span><span class="p">(</span><span class="n">filename_pkl</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_recording_data"><a class="viewcode-back" href="../fig_ms.html#fig_ms.load_recording_data">[docs]</a><span class="k">def</span> <span class="nf">load_recording_data</span><span class="p">(</span><span class="n">path_to_traces</span><span class="p">,</span> <span class="n">path_to_spiketimes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get voltage traces from all .mat files in path_to_traces.</span>

<span class="sd">    :param path_to_traces: path to directory containing .mat files of recorded traces</span>
<span class="sd">    :type path_to_traces: str or None</span>
<span class="sd">    :param path_to_spiketimes: path to directory containing .pkl files with spiketimes of recorded traces</span>
<span class="sd">    :type path_to_spiketimes: str or None</span>
<span class="sd">    :return:    - traces_rec: list of lists of recorded traces, one sub-list per neuron, one sub-sub-list per trial</span>
<span class="sd">                - trace_filenames: list of filenames of the read out .mat files</span>
<span class="sd">                - spiketimes_rec: list of lists of spiketimes, one sub-list per neuron, one sub-sub-list per trial</span>
<span class="sd">                - spiketimes_filenames: list of filenames of the read out .pkl files</span>
<span class="sd">    :rtype:     - traces_rec: list</span>
<span class="sd">                - trace_filenames: list</span>
<span class="sd">                - spiketimes_rec: list</span>
<span class="sd">                - spiketimes_filenames: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get a list of .mat filenames in traces directory</span>
    <span class="k">if</span> <span class="n">path_to_traces</span><span class="p">:</span>
        <span class="n">path_to_traces</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path_to_traces</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trace_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_to_traces</span><span class="p">)</span>
                               <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_traces</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.mat&#39;</span><span class="p">)]</span>
            <span class="n">trace_filenames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span> <span class="o">+</span> <span class="n">path_to_traces</span> <span class="o">+</span> <span class="s1">&#39; was not found.&#39;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span> <span class="o">+</span> <span class="n">path_to_traces</span> <span class="o">+</span> <span class="s1">&#39; was found but something went wrong trying to read files from it.&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="c1"># get a list of .pkl filenames in spiketimes directory</span>
    <span class="k">if</span> <span class="n">path_to_spiketimes</span><span class="p">:</span>
        <span class="n">path_to_spiketimes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path_to_spiketimes</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">spiketimes_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_to_spiketimes</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_spiketimes</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)]</span>
            <span class="n">spiketimes_filenames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span> <span class="o">+</span> <span class="n">path_to_spiketimes</span> <span class="o">+</span> <span class="s1">&#39; was not found.&#39;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span> <span class="o">+</span> <span class="n">path_to_spiketimes</span> <span class="o">+</span> <span class="s1">&#39; was found but something went wrong trying to read files from it.&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="c1"># get traces from files</span>
    <span class="k">if</span> <span class="n">path_to_traces</span><span class="p">:</span>
        <span class="n">traces_rec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">trace_filenames</span><span class="p">:</span>
            <span class="n">traces_rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_io</span><span class="o">.</span><span class="n">load_traces_from_mat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_traces</span><span class="p">,</span> <span class="n">filename</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">traces_rec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">trace_filenames</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># get spiketimes from files</span>
    <span class="k">if</span> <span class="n">path_to_spiketimes</span><span class="p">:</span>
        <span class="n">spiketimes_rec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">spiketimes_filenames</span><span class="p">:</span>
            <span class="n">spiketimes_rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_io</span><span class="o">.</span><span class="n">load_spiketimes_from_pkl</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_spiketimes</span><span class="p">,</span> <span class="n">filename</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spiketimes_rec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">spiketimes_filenames</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">traces_rec</span><span class="p">,</span> <span class="n">trace_filenames</span><span class="p">,</span> <span class="n">spiketimes_rec</span><span class="p">,</span> <span class="n">spiketimes_filenames</span></div>


<div class="viewcode-block" id="get_suppression_window"><a class="viewcode-back" href="../fig_ms.html#fig_ms.get_suppression_window">[docs]</a><span class="k">def</span> <span class="nf">get_suppression_window</span><span class="p">(</span><span class="n">config_jam_only</span><span class="p">,</span> <span class="n">spikes_jam_ft</span><span class="p">,</span> <span class="n">config_jam_ft</span><span class="p">,</span> <span class="n">info_jam_ft</span><span class="p">):</span>
    <span class="c1"># time window after playback onset in which a burst would be suppressed by jamming inhibition</span>
    <span class="n">idx_nrn_oi_mod_abs_trc</span> <span class="o">=</span> <span class="n">p_util</span><span class="o">.</span><span class="n">get_abs_from_rel_nrn_idx</span><span class="p">(</span><span class="n">config_jam_ft</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_nrn_oi_relative&#39;</span><span class="p">],</span>
                                                             <span class="n">config_jam_ft</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_pop_oi&#39;</span><span class="p">],</span>
                                                             <span class="n">info_jam_ft</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;population_sizes&#39;</span><span class="p">])</span>
    <span class="n">idx_t_start</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">idx_pop_fp</span> <span class="o">=</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">][</span><span class="s1">&#39;idx_synpop_oi_for_fp&#39;</span><span class="p">]</span>
    <span class="n">lat_playback_to_t_start</span> <span class="o">=</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;input_current&#39;</span><span class="p">][</span><span class="s1">&#39;t_start&#39;</span><span class="p">][</span><span class="n">idx_pop_fp</span><span class="p">][</span><span class="n">idx_t_start</span><span class="p">]</span> \
                              <span class="o">-</span> <span class="n">config_jam_only</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">][</span><span class="s1">&#39;playback_start&#39;</span><span class="p">]</span>
    <span class="n">t_first_spike_no_jam</span> <span class="o">=</span> <span class="n">spikes_jam_ft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span>
    <span class="n">t_unperturbed_bursts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_perturbed_bursts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">)):</span>
        <span class="n">t_start_jam</span> <span class="o">=</span> <span class="n">info_jam_ft</span><span class="p">[</span><span class="n">mon</span><span class="p">][</span><span class="s1">&#39;free_parameter_values&#39;</span><span class="p">][</span><span class="n">idx_pop_fp</span><span class="p">][</span><span class="n">idx_t_start</span><span class="p">]</span>
        <span class="n">playback_onset</span> <span class="o">=</span> <span class="n">t_start_jam</span> <span class="o">-</span> <span class="n">lat_playback_to_t_start</span>
        <span class="n">idx_spikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">mon</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">idx_nrn_oi_mod_abs_trc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_unperturbed_bursts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_first_spike_no_jam</span> <span class="o">-</span> <span class="n">playback_onset</span><span class="p">)</span>  <span class="c1"># relative to playback onset</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">mon</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spikes</span><span class="p">]):</span>
            <span class="n">t_perturbed_bursts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikes_jam_ft</span><span class="p">[</span><span class="n">mon</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spikes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">b2</span><span class="o">.</span><span class="n">ms</span> <span class="o">-</span> <span class="n">playback_onset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t_perturbed_bursts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">stepsize_burst_time</span> <span class="o">=</span> <span class="n">config_jam_ft</span><span class="p">[</span><span class="s1">&#39;free_parameter_stepsize&#39;</span><span class="p">][</span><span class="s1">&#39;t_start&#39;</span><span class="p">]</span>
    <span class="n">i_suppressed_burst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">t_perturbed_bursts</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">original_burst_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_unperturbed_bursts</span><span class="p">)</span>
    <span class="n">t_suppressed_bursts</span> <span class="o">=</span> <span class="n">original_burst_times</span><span class="p">[</span><span class="n">i_suppressed_burst</span><span class="p">]</span>
    <span class="n">suppression_window_playback_ms_lr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">t_suppressed_bursts</span><span class="p">)</span> <span class="o">-</span> <span class="n">stepsize_burst_time</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">t_suppressed_bursts</span><span class="p">)</span> <span class="o">+</span> <span class="n">stepsize_burst_time</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">suppr_win_l</span> <span class="o">=</span> <span class="n">suppression_window_playback_ms_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">suppr_win_r</span> <span class="o">=</span> <span class="n">suppression_window_playback_ms_lr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">suppr_win_l</span><span class="p">,</span> <span class="n">suppr_win_r</span><span class="p">]</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, Philipp Norton.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>